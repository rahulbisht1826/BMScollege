<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - BMS College</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="icon" type="image/png" href="images/logo.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            color: #e0e0e0;
        }

        /* ── Login Screen ─────────────────────────── */
        .login-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 50px 40px;
            border-radius: 20px;
            width: 100%;
            max-width: 440px;
            text-align: center;
        }

        .login-card .logo-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 30px;
            color: #fff;
        }

        .login-card h2 {
            color: #fff;
            margin-bottom: 8px;
            font-size: 22px;
        }

        .login-card p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 13px;
            margin-bottom: 30px;
        }

        /* ── Form Controls ────────────────────────── */
        .form-group {
            margin-bottom: 18px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 7px;
            font-weight: 500;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            color: #fff;
            font-family: inherit;
            font-size: 14px;
            transition: 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .form-group select option {
            background: #1a1a2e;
            color: #fff;
        }

        .form-group input[type="file"] {
            padding: 10px;
        }

        .input-with-toggle {
            position: relative;
        }

        .input-with-toggle input {
            padding-right: 45px;
        }

        .toggle-visibility {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
            transition: 0.2s;
        }

        .toggle-visibility:hover {
            color: #667eea;
        }

        /* ── Buttons ──────────────────────────────── */
        .btn {
            width: 100%;
            padding: 13px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: #fff;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 54, 92, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #fff;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            color: #ccc;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-delete-item,
        .btn-edit-item {
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--g-transition);
        }

        .btn-delete-item {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .btn-delete-item:hover {
            background: rgba(239, 68, 68, 0.4);
        }

        .btn-edit-item {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            margin-right: 4px;
        }

        .btn-edit-item:hover {
            background: rgba(245, 158, 11, 0.4);
        }

        .item-actions {
            display: flex;
            gap: 4px;
            align-items: center;
            flex-shrink: 0;
        }

        .cancel-edit-link {
            color: #f59e0b;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            text-decoration: underline;
        }

        .cancel-edit-link:hover {
            color: #fbbf24;
        }

        .editing-indicator {
            display: inline-block;
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 8px;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
            width: auto;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* ── Dashboard Layout ─────────────────────── */
        #dashboard {
            display: none;
        }

        .dash-topbar {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .dash-topbar .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 16px;
            color: #fff;
        }

        .dash-topbar .brand i {
            font-size: 22px;
            color: #667eea;
        }

        .dash-topbar-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dash-container {
            max-width: 900px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* ── Cards ────────────────────────────────── */
        .card {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .card-header h3 {
            font-size: 17px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-header h3 i {
            color: #667eea;
            font-size: 18px;
        }

        /* ── Alerts ───────────────────────────────── */
        .alert {
            padding: 14px 18px;
            border-radius: 10px;
            font-size: 13px;
            margin-bottom: 18px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .alert.show {
            display: flex;
        }

        .alert-error {
            background: rgba(245, 54, 92, 0.15);
            border: 1px solid rgba(245, 54, 92, 0.3);
            color: #ff6b8a;
        }

        .alert-success {
            background: rgba(45, 206, 137, 0.15);
            border: 1px solid rgba(45, 206, 137, 0.3);
            color: #2dce89;
        }

        .alert-info {
            background: rgba(102, 126, 234, 0.15);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #8ea4f7;
        }

        /* ── Page Selector Tabs ───────────────────── */
        .page-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .page-tab {
            padding: 10px 20px;
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.04);
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            font-family: inherit;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .page-tab:hover {
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
        }

        .page-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: transparent;
            color: #fff;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        /* ── Media / Item Lists ───────────────────── */
        .item-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .item-list::-webkit-scrollbar {
            width: 5px;
        }

        .item-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
        }

        .media-item,
        .faculty-item,
        .course-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 12px;
            margin-bottom: 10px;
            transition: 0.2s;
        }

        .media-item:hover,
        .faculty-item:hover,
        .course-item:hover {
            border-color: rgba(245, 54, 92, 0.3);
            background: rgba(245, 54, 92, 0.05);
        }

        .media-item img,
        .media-item video {
            width: 80px;
            height: 55px;
            object-fit: cover;
            border-radius: 8px;
            background: #000;
            flex-shrink: 0;
        }

        .faculty-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .item-info {
            flex: 1;
            min-width: 0;
        }

        .item-info .item-name {
            font-size: 13px;
            font-weight: 500;
            color: #fff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item-info .item-sub {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 2px;
        }


        /* ── Page-Specific Panels ─────────────────── */
        .page-panel {
            display: none;
        }

        .page-panel.active {
            display: block;
        }

        /* ── Token Bar ────────────────────────────── */
        .token-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 18px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .token-bar i {
            color: #667eea;
            font-size: 16px;
        }

        .token-bar span {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .token-bar .token-status {
            margin-left: auto;
            font-size: 11px;
            padding: 3px 10px;
            border-radius: 20px;
        }

        .token-bar .token-status.connected {
            background: rgba(45, 206, 137, 0.15);
            color: #2dce89;
            border: 1px solid rgba(45, 206, 137, 0.3);
        }

        .token-bar .token-status.missing {
            background: rgba(245, 54, 92, 0.15);
            color: #ff6b8a;
            border: 1px solid rgba(245, 54, 92, 0.3);
        }

        /* ── Spinner ──────────────────────────────── */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            animation: spin 0.8s linear infinite;
            display: none;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ── Stats Row ────────────────────────────── */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 14px;
            padding: 20px;
            text-align: center;
        }

        .stat-card .stat-num {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-card .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 5px;
        }

        /* ── Separator ────────────────────────────── */
        .separator {
            height: 1px;
            background: rgba(255, 255, 255, 0.08);
            margin: 20px 0;
        }

        /* ── Responsive ──────────────────────────── */
        @media (max-width: 600px) {
            .dash-topbar {
                padding: 12px 15px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .dash-container {
                padding: 0 12px;
            }

            .card {
                padding: 20px 16px;
            }

            .page-tab {
                padding: 8px 14px;
                font-size: 12px;
            }

            .faculty-item,
            .course-item,
            .media-item {
                flex-wrap: wrap;
            }
        }
    </style>
</head>

<body>
    <!-- ══════════════ LOGIN SCREEN ══════════════ -->
    <div class="login-wrapper" id="login-screen">
        <div class="login-card">
            <div class="logo-icon"><i class="fa-solid fa-shield-halved"></i></div>
            <h2>Admin Portal</h2>
            <p>BMS College Content Management System</p>

            <div class="alert alert-error" id="login-error"><i class="fa-solid fa-circle-exclamation"></i> Invalid ID or
                Password.</div>

            <div class="form-group">
                <label>Admin ID</label>
                <input type="text" id="admin-id" placeholder="Enter your admin ID" autocomplete="username">
            </div>
            <div class="form-group">
                <label>Password</label>
                <div class="input-with-toggle">
                    <input type="password" id="admin-pass" placeholder="Enter your password"
                        autocomplete="current-password">
                    <button class="toggle-visibility" onclick="toggleVis('admin-pass', this)"><i
                            class="fa-solid fa-eye"></i></button>
                </div>
            </div>
            <button class="btn btn-primary" onclick="login()"><i class="fa-solid fa-right-to-bracket"></i>
                Login</button>
        </div>
    </div>

    <!-- ══════════════ DASHBOARD ══════════════ -->
    <div id="dashboard">
        <!-- Top Bar -->
        <div class="dash-topbar">
            <div class="brand"><i class="fa-solid fa-gauge-high"></i> Admin Dashboard</div>
            <div class="dash-topbar-actions">
                <button class="btn btn-secondary btn-sm" onclick="logout()"><i
                        class="fa-solid fa-right-from-bracket"></i>
                    Logout</button>
            </div>
        </div>

        <div class="dash-container">
            <!-- Alerts -->
            <div class="alert alert-error" id="dash-error"><i class="fa-solid fa-circle-exclamation"></i> <span
                    id="dash-error-text"></span></div>
            <div class="alert alert-success" id="dash-success"><i class="fa-solid fa-circle-check"></i> <span
                    id="dash-success-text"></span></div>

            <!-- Token Management Card -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fa-solid fa-key"></i> GitHub Token</h3>
                    <div id="token-status-badge"></div>
                </div>
                <p style="font-size: 12px; color: rgba(255,255,255,0.4); margin-bottom: 15px;">Your token is stored
                    permanently in this browser. You only need to set it once.</p>
                <div class="form-group" style="margin-bottom: 10px;">
                    <div class="input-with-toggle">
                        <input type="password" id="gh-token" placeholder="ghp_........................">
                        <button class="toggle-visibility" onclick="toggleVis('gh-token', this)"><i
                                class="fa-solid fa-eye"></i></button>
                    </div>
                </div>
                <div style="display:flex; gap:8px;">
                    <button class="btn btn-primary btn-sm" onclick="saveToken()" style="flex:1"><i
                            class="fa-solid fa-floppy-disk"></i> Save Token</button>
                    <button class="btn btn-secondary btn-sm" onclick="clearToken()" style="flex:1"><i
                            class="fa-solid fa-trash"></i> Clear Token</button>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-row" id="stats-row">
                <div class="stat-card">
                    <div class="stat-num" id="stat-faculty">0</div>
                    <div class="stat-label">Faculty Members</div>
                </div>
                <div class="stat-card">
                    <div class="stat-num" id="stat-courses">0</div>
                    <div class="stat-label">Courses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-num" id="stat-media">0</div>
                    <div class="stat-label">Media Files</div>
                </div>
            </div>

            <!-- Page Selector Tabs -->
            <div class="page-tabs">
                <button class="page-tab active" data-page="home" onclick="switchPage('home')"><i
                        class="fa-solid fa-house"></i> Home</button>
                <button class="page-tab" data-page="about" onclick="switchPage('about')"><i
                        class="fa-solid fa-circle-info"></i> About</button>
                <button class="page-tab" data-page="faculty" onclick="switchPage('faculty')"><i
                        class="fa-solid fa-chalkboard-user"></i> Faculty</button>
                <button class="page-tab" data-page="courses" onclick="switchPage('courses')"><i
                        class="fa-solid fa-graduation-cap"></i> Courses</button>
                <button class="page-tab" data-page="placement" onclick="switchPage('placement')"><i
                        class="fa-solid fa-briefcase"></i> Placement</button>
                <button class="page-tab" data-page="contact" onclick="switchPage('contact')"><i
                        class="fa-solid fa-envelope"></i> Contact</button>
                <button class="page-tab" data-page="sitemap" onclick="switchPage('sitemap')"><i
                        class="fa-solid fa-sitemap"></i> Sitemap</button>
            </div>

            <!-- ═══ HOME PAGE PANEL ═══ -->
            <div class="page-panel active" id="panel-home">
                <!-- Notice -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-bullhorn"></i> Notice Banner</h3>
                        <button class="btn btn-danger btn-sm" onclick="document.getElementById('notice-text').value=''"
                            title="Clear Notice"><i class="fa-solid fa-eraser"></i> Clear</button>
                    </div>
                    <div class="form-group">
                        <textarea id="notice-text" rows="3"
                            placeholder="Enter important notice to display on homepage..."></textarea>
                    </div>
                </div>

                <!-- Existing Media -->
                <div class="card" id="existing-media-card" style="display:none;">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-photo-film"></i> Current Media</h3>
                    </div>
                    <div class="item-list" id="existing-media-list"></div>
                </div>

                <!-- Upload New -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-cloud-arrow-up"></i> Upload New Media</h3>
                    </div>
                    <div class="form-group">
                        <label><i class="fa-solid fa-image" style="margin-right:6px; color:#667eea;"></i> Image
                            File</label>
                        <input type="file" id="image-upload" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label><i class="fa-solid fa-film" style="margin-right:6px; color:#667eea;"></i> Video File
                            (max 20MB)</label>
                        <input type="file" id="video-upload" accept="video/mp4,video/webm">
                    </div>
                </div>
            </div>

            <!-- ═══ FACULTY PAGE PANEL ═══ -->
            <div class="page-panel" id="panel-faculty">
                <!-- Add Faculty -->
                <div class="card" id="fac-form-card">
                    <div class="card-header">
                        <h3 id="fac-form-title"><i class="fa-solid fa-user-plus"></i> Add New Faculty</h3>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="fac-name" placeholder="e.g., Dr. John Smith">
                        </div>
                        <div class="form-group">
                            <label>Designation / Tag *</label>
                            <input type="text" id="fac-tag" placeholder="e.g., Assistant Professor">
                        </div>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Education</label>
                            <input type="text" id="fac-edu" placeholder="e.g., Ph.D, MBA, B.COM">
                        </div>
                        <div class="form-group">
                            <label>Experience</label>
                            <input type="text" id="fac-exp" placeholder="e.g., 10+ Years">
                        </div>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="fac-email" placeholder="e.g., name@bmsccm.ac.in">
                        </div>
                        <div class="form-group">
                            <label>Category *</label>
                            <select id="fac-category">
                                <option value="faculty-member">Faculty Member</option>
                                <option value="chairman">Chairman</option>
                                <option value="principal">Principal</option>
                                <option value="non-teaching">Non Teaching</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Bio / Description *</label>
                        <textarea id="fac-bio" rows="3" placeholder="Short biography..."></textarea>
                    </div>
                    <div class="form-group">
                        <label><i class="fa-solid fa-camera" style="margin-right:6px; color:#667eea;"></i> Photo
                            (leave empty to keep current photo when editing)</label>
                        <input type="file" id="fac-photo" accept="image/*">
                    </div>
                    <div style="display: flex; align-items: center;">
                        <button class="btn btn-primary" id="fac-submit-btn" onclick="addFaculty()"><i
                                class="fa-solid fa-plus"></i> Add Faculty Member</button>
                        <span class="cancel-edit-link" id="fac-cancel-edit" style="display:none;"
                            onclick="cancelEditFaculty()">✕ Cancel Edit</span>
                    </div>
                </div>

                <!-- Existing Faculty -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-users"></i> Current Faculty (<span id="fac-count">0</span>)</h3>
                    </div>
                    <div class="item-list" id="faculty-list"></div>
                </div>
            </div>

            <!-- ═══ COURSES PAGE PANEL ═══ -->
            <div class="page-panel" id="panel-courses">
                <!-- Add Course -->
                <div class="card" id="course-form-card">
                    <div class="card-header">
                        <h3 id="course-form-title"><i class="fa-solid fa-circle-plus"></i> Add New Course</h3>
                    </div>
                    <div class="form-group">
                        <label>Course Title *</label>
                        <input type="text" id="course-title" placeholder="e.g., BACHELOR OF COMMERCE (B.COM)">
                    </div>
                    <div class="form-group">
                        <label>Description *</label>
                        <textarea id="course-desc" rows="2" placeholder="Brief description of the course..."></textarea>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Category *</label>
                            <select id="course-cat">
                                <option value="bca">BCA</option>
                                <option value="bba">BBA</option>
                                <option value="bcom">B.COM</option>
                                <option value="management">Management</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Image URL (or upload below)</label>
                            <input type="text" id="course-img" placeholder="https://... (leave empty for default)">
                        </div>
                    </div>
                    <div class="form-group">
                        <label><i class="fa-solid fa-upload" style="margin-right:6px; color:#667eea;"></i> Or upload
                            image from PC</label>
                        <input type="file" id="course-img-file" accept="image/*">
                    </div>
                    <div style="display: flex; align-items: center;">
                        <button class="btn btn-primary" id="course-submit-btn" onclick="addCourse()"><i
                                class="fa-solid fa-plus"></i> Add Course</button>
                        <span class="cancel-edit-link" id="course-cancel-edit" style="display:none;"
                            onclick="cancelEditCourse()">✕ Cancel Edit</span>
                    </div>
                </div>

                <!-- Existing Courses -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-book-open"></i> Current Courses (<span id="course-count">0</span>)
                        </h3>
                    </div>
                    <div class="item-list" id="courses-list"></div>
                </div>
            </div>

            <!-- ═══ ABOUT PAGE PANEL ═══ -->
            <div class="page-panel" id="panel-about">
                <!-- Welcome Text -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-pen-fancy"></i> Welcome Section</h3>
                    </div>
                    <div class="form-group">
                        <label>Heading</label>
                        <input type="text" id="about-heading" placeholder="e.g., Welcome to BMS COLLEGE...">
                    </div>
                    <div class="form-group">
                        <label>Paragraph 1</label>
                        <textarea id="about-para1" rows="3"
                            placeholder="First paragraph of the about section..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Paragraph 2</label>
                        <textarea id="about-para2" rows="3"
                            placeholder="Second paragraph of the about section..."></textarea>
                    </div>
                </div>

                <!-- Feature Cards -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-star"></i> Highlight Cards (<span id="about-card-count">3</span>)</h3>
                    </div>
                    <p style="font-size:12px; color:rgba(255,255,255,0.4); margin-bottom:15px;">Edit the 3 feature
                        highlight cards shown on the About page.</p>
                    <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px;">
                        <div class="form-group">
                            <label>Card 1 Title</label>
                            <input type="text" id="about-card1-title" placeholder="e.g., Top Rated">
                        </div>
                        <div class="form-group">
                            <label>Card 2 Title</label>
                            <input type="text" id="about-card2-title" placeholder="e.g., Global Community">
                        </div>
                        <div class="form-group">
                            <label>Card 3 Title</label>
                            <input type="text" id="about-card3-title" placeholder="e.g., Certified Courses">
                        </div>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px;">
                        <div class="form-group">
                            <label>Card 1 Description</label>
                            <textarea id="about-card1-desc" rows="2" placeholder="Short description..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Card 2 Description</label>
                            <textarea id="about-card2-desc" rows="2" placeholder="Short description..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Card 3 Description</label>
                            <textarea id="about-card3-desc" rows="2" placeholder="Short description..."></textarea>
                        </div>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px;">
                        <div class="form-group">
                            <label>Card 1 Icon (FA class)</label>
                            <input type="text" id="about-card1-icon" placeholder="fa-solid fa-trophy">
                        </div>
                        <div class="form-group">
                            <label>Card 2 Icon (FA class)</label>
                            <input type="text" id="about-card2-icon" placeholder="fa-solid fa-globe">
                        </div>
                        <div class="form-group">
                            <label>Card 3 Icon (FA class)</label>
                            <input type="text" id="about-card3-icon" placeholder="fa-solid fa-certificate">
                        </div>
                    </div>
                </div>

                <!-- Image Gallery Management -->
                <div class="card" id="about-gallery-form-card">
                    <div class="card-header">
                        <h3 id="about-gallery-form-title"><i class="fa-solid fa-images"></i> Add Gallery Image</h3>
                    </div>
                    <p style="font-size:12px; color:rgba(255,255,255,0.4); margin-bottom:15px;">Manage the expanding
                        image gallery on the About page ("Explore Our Campus" section).</p>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Image URL (or upload below)</label>
                            <input type="text" id="gallery-img" placeholder="https://images.unsplash.com/...">
                        </div>
                    </div>
                    <div class="form-group">
                        <label><i class="fa-solid fa-upload" style="margin-right:6px; color:#667eea;"></i> Or upload
                            image
                            from PC</label>
                        <input type="file" id="gallery-img-file" accept="image/*">
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Icon (FA class) *</label>
                            <input type="text" id="gallery-icon" placeholder="fas fa-university">
                        </div>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Title *</label>
                            <input type="text" id="gallery-title" placeholder="e.g., Main Building">
                        </div>
                        <div class="form-group">
                            <label>Subtitle *</label>
                            <input type="text" id="gallery-sub"
                                placeholder="e.g., Where heritage meets modern education.">
                        </div>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <button class="btn btn-primary" id="gallery-submit-btn" onclick="addGalleryItem()"><i
                                class="fa-solid fa-plus"></i> Add Gallery Image</button>
                        <span class="cancel-edit-link" id="gallery-cancel-edit" style="display:none;"
                            onclick="cancelEditGallery()">✕ Cancel Edit</span>
                    </div>
                </div>

                <!-- Existing Gallery Items -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-images"></i> Current Gallery (<span id="gallery-count">0</span>)</h3>
                    </div>
                    <div class="item-list" id="gallery-list"></div>
                </div>

                <!-- Video Gallery Management -->
                <div class="card" id="about-video-form-card">
                    <div class="card-header">
                        <h3 id="about-video-form-title"><i class="fa-solid fa-film"></i> Add Video Card</h3>
                    </div>
                    <p style="font-size:12px; color:rgba(255,255,255,0.4); margin-bottom:15px;">Manage the video gallery
                        on the About page ("Campus Pulse" section).</p>
                    <div class="form-group">
                        <label>Video URL (or upload below)</label>
                        <input type="text" id="about-vid-src" placeholder="video/myfile.mp4 or https://...">
                    </div>
                    <div class="form-group">
                        <label><i class="fa-solid fa-upload" style="margin-right:6px; color:#667eea;"></i> Or upload
                            video
                            from PC</label>
                        <input type="file" id="about-vid-file" accept="video/*">
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Title *</label>
                            <input type="text" id="about-vid-title" placeholder="e.g., Aerial Campus View">
                        </div>
                        <div class="form-group">
                            <label>Description *</label>
                            <input type="text" id="about-vid-desc"
                                placeholder="e.g., Experience the vastness of our campus.">
                        </div>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <button class="btn btn-primary" id="about-vid-submit-btn" onclick="addAboutVideo()"><i
                                class="fa-solid fa-plus"></i> Add Video Card</button>
                        <span class="cancel-edit-link" id="about-vid-cancel-edit" style="display:none;"
                            onclick="cancelEditAboutVideo()">✕ Cancel Edit</span>
                    </div>
                </div>

                <!-- Existing Video Items -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-film"></i> Current Videos (<span id="about-vid-count">0</span>)</h3>
                    </div>
                    <div class="item-list" id="about-vid-list"></div>
                </div>
            </div>

            <!-- ═══ PLACEMENT PAGE PANEL ═══ -->
            <div class="page-panel" id="panel-placement">
                <!-- Add Placement -->
                <div class="card" id="place-form-card">
                    <div class="card-header">
                        <h3 id="place-form-title"><i class="fa-solid fa-user-tie"></i> Add Placement Record</h3>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Student Name *</label>
                            <input type="text" id="place-name" placeholder="e.g., Rahul Sharma">
                        </div>
                        <div class="form-group">
                            <label>Company *</label>
                            <input type="text" id="place-company" placeholder="e.g., Infosys">
                        </div>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Role / Designation</label>
                            <input type="text" id="place-role" placeholder="e.g., Software Engineer">
                        </div>
                        <div class="form-group">
                            <label>Package (LPA)</label>
                            <input type="text" id="place-package" placeholder="e.g., 6.5 LPA">
                        </div>
                        <div class="form-group">
                            <label>Year</label>
                            <input type="text" id="place-year" placeholder="e.g., 2024">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Course / Department</label>
                        <input type="text" id="place-dept" placeholder="e.g., BCA, BBA, B.COM">
                    </div>
                    <div style="display: flex; align-items: center;">
                        <button class="btn btn-primary" id="place-submit-btn" onclick="addPlacement()"><i
                                class="fa-solid fa-plus"></i> Add Placement Record</button>
                        <span class="cancel-edit-link" id="place-cancel-edit" style="display:none;"
                            onclick="cancelEditPlacement()">✕ Cancel Edit</span>
                    </div>
                </div>

                <!-- Placement Stats -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-chart-bar"></i> Placement Highlights</h3>
                    </div>
                    <p style="font-size:12px; color:rgba(255,255,255,0.4); margin-bottom:15px;">These stats are shown at
                        the top of the Placement page.</p>
                    <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px;">
                        <div class="form-group">
                            <label>Total Placements</label>
                            <input type="text" id="place-stat-total" placeholder="e.g., 150+">
                        </div>
                        <div class="form-group">
                            <label>Top Recruiters</label>
                            <input type="text" id="place-stat-recruiters" placeholder="e.g., 40+">
                        </div>
                        <div class="form-group">
                            <label>Highest Package</label>
                            <input type="text" id="place-stat-highest" placeholder="e.g., 12 LPA">
                        </div>
                    </div>
                </div>

                <!-- Existing Placements -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-list-check"></i> Placement Records (<span id="place-count">0</span>)
                        </h3>
                    </div>
                    <div class="item-list" id="placement-list"></div>
                </div>
            </div>

            <!-- ═══ CONTACT PAGE PANEL ═══ -->
            <div class="page-panel" id="panel-contact">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-address-card"></i> Contact Information</h3>
                    </div>
                    <p style="font-size:12px; color:rgba(255,255,255,0.4); margin-bottom:15px;">Edit the contact details
                        displayed on the Contact page.</p>
                    <div class="form-group">
                        <label><i class="fa-solid fa-location-dot" style="margin-right:6px; color:#667eea;"></i>
                            Address</label>
                        <textarea id="contact-address" rows="2" placeholder="Full college address..."></textarea>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label><i class="fa-solid fa-phone" style="margin-right:6px; color:#667eea;"></i>
                                Phone</label>
                            <input type="text" id="contact-phone" placeholder="e.g., 080-26610174">
                        </div>
                        <div class="form-group">
                            <label><i class="fa-solid fa-envelope" style="margin-right:6px; color:#667eea;"></i>
                                Email</label>
                            <input type="text" id="contact-email" placeholder="e.g., principal@bmsccm.ac.in">
                        </div>
                    </div>
                    <div class="form-group">
                        <label><i class="fa-solid fa-map" style="margin-right:6px; color:#667eea;"></i> Google Maps
                            Embed URL</label>
                        <input type="text" id="contact-map"
                            placeholder="https://maps.google.com/maps?q=...&output=embed">
                    </div>
                </div>
            </div>

            <!-- ═══ SITEMAP PAGE PANEL ═══ -->
            <div class="page-panel" id="panel-sitemap">
                <!-- Add Sitemap Entry -->
                <div class="card" id="sitemap-form-card">
                    <div class="card-header">
                        <h3 id="sitemap-form-title"><i class="fa-solid fa-circle-plus"></i> Add Sitemap Entry</h3>
                    </div>
                    <p style="font-size:12px; color:rgba(255,255,255,0.4); margin-bottom:15px;">Manage the pages listed
                        in sitemap.html and sitemap.xml. You can add, edit, temporarily hide, or permanently delete
                        entries.</p>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Page Title *</label>
                            <input type="text" id="sm-title" placeholder="e.g., About Us">
                        </div>
                        <div class="form-group">
                            <label>URL / Filename *</label>
                            <input type="text" id="sm-url" placeholder="e.g., about.html">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description *</label>
                        <input type="text" id="sm-desc"
                            placeholder="e.g., Campus gallery, video showcase, college history">
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap: 12px;">
                        <div class="form-group">
                            <label>Icon (FA class) *</label>
                            <input type="text" id="sm-icon" placeholder="fa-solid fa-info-circle">
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select id="sm-priority">
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low / Utility</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Change Freq (XML)</label>
                            <select id="sm-freq">
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="yearly">Yearly</option>
                                <option value="daily">Daily</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <button class="btn btn-primary" id="sm-submit-btn" onclick="addSitemapEntry()"><i
                                class="fa-solid fa-plus"></i> Add Entry</button>
                        <span class="cancel-edit-link" id="sm-cancel-edit" style="display:none;"
                            onclick="cancelEditSitemap()">✕ Cancel Edit</span>
                    </div>
                </div>

                <!-- Existing Sitemap Entries -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-sitemap"></i> Current Sitemap Entries (<span id="sm-count">0</span>)
                        </h3>
                    </div>
                    <p style="font-size:12px; color:rgba(255,255,255,0.4); margin-bottom:10px;">
                        <i class="fa-solid fa-eye-slash" style="color:#ffc107;"></i> = Temporarily hidden (not shown on
                        website but kept in data)
                        &nbsp;|&nbsp; <i class="fa-solid fa-trash" style="color:#ff6b8a;"></i> = Permanently delete
                    </p>
                    <div class="item-list" id="sitemap-list"></div>
                </div>
            </div>

            <!-- ═══ PUBLISH BUTTON ═══ -->
            <button class="btn btn-primary" id="publish-btn" onclick="publishChanges()"
                style="padding: 16px; font-size: 16px; margin-bottom: 40px;">
                <span class="spinner" id="publish-spinner"></span>
                <i class="fa-solid fa-rocket" id="publish-icon"></i>
                <span id="publish-text">Publish All Changes</span>
            </button>
        </div>
    </div>

    <script>
        // ══════════════════════════════════════════════════
        //  CONSTANTS & STATE
        // ══════════════════════════════════════════════════
        const REPO = 'rahulbisht1826/BMScollege';
        let siteData = {
            notice: '', images: [], videos: [],
            faculty: [], courses: [],
            about: {
                heading: 'Welcome to BMS COLLEGE OF COMMERCE & MANAGEMENT',
                para1: '',
                para2: '',
                cards: [
                    { title: 'Top Rated', desc: 'Recognized as one of the best universities globally.', icon: 'fa-solid fa-trophy' },
                    { title: 'Global Community', desc: 'Students from over 100 countries around the world.', icon: 'fa-solid fa-globe' },
                    { title: 'Certified Courses', desc: 'Get certified upon completion of our premium courses.', icon: 'fa-solid fa-certificate' }
                ],
                gallery: [
                    { image: 'https://images.unsplash.com/photo-1541339907198-e08756dedf3f?q=80&w=2070&auto=format&fit=crop', icon: 'fas fa-university', title: 'Main Building', sub: 'Where heritage meets modern education.' },
                    { image: 'https://images.unsplash.com/photo-1562774053-701939374585?q=80&w=1986&auto=format&fit=crop', icon: 'fas fa-microscope', title: 'Advanced Labs', sub: 'Equipped with state-of-the-art research tools.' },
                    { image: 'https://images.unsplash.com/photo-1521587760476-6c12a4b040da?q=80&w=2070&auto=format&fit=crop', icon: 'fas fa-book-reader', title: 'Library Center', sub: 'A quiet sanctuary for knowledge seekers.' },
                    { image: 'https://images.unsplash.com/photo-1519337265831-281ec6cc8514?q=80&w=2070&auto=format&fit=crop', icon: 'fas fa-users', title: 'Student Lounge', sub: 'Cultivating collaboration and community.' },
                    { image: 'https://images.unsplash.com/photo-1504450758481-7338eba7524a?q=80&w=2069&auto=format&fit=crop', icon: 'fas fa-running', title: 'Sports Arena', sub: 'Fueling the competitive spirit.' }
                ],
                aboutVideos: [
                    { src: 'video/32aa32b3564e50d11cca18f1b63fac0b_720w.mp4', title: 'Aerial Campus View', desc: 'Experience the vastness of our historic campus from a new perspective.' },
                    { src: 'video/ec0266fb955b9521ead16989d2b76944.mp4', title: 'Student Connections', desc: 'Lifelong friendships start in our collaborative student hubs.' },
                    { src: 'https://assets.mixkit.co/videos/preview/mixkit-students-walking-in-a-university-campus-41551-large.mp4', title: 'Campus Pathways', desc: 'Walk through the iconic corridors of academic excellence.' },
                    { src: 'https://assets.mixkit.co/videos/preview/mixkit-university-building-and-fountain-41553-large.mp4', title: 'The Landmark Fountain', desc: 'Our landmarks tell the story of a century-long legacy.' },
                    { src: 'https://assets.mixkit.co/videos/preview/mixkit-young-man-studying-with-a-headset-in-a-library-41555-large.mp4', title: 'Study Sanctuaries', desc: 'Libraries designed for deep focus and digital research.' },
                    { src: 'https://assets.mixkit.co/videos/preview/mixkit-students-talking-in-the-university-41558-large.mp4', title: 'Academic Synergy', desc: 'Vibrant discussions that spark innovation and leadership.' },
                    { src: 'https://assets.mixkit.co/videos/preview/mixkit-female-student-reading-in-the-university-library-41557-large.mp4', title: 'Knowledge Discovery', desc: 'Dive deep into our global archives and vast academic databases.' },
                    { src: 'https://assets.mixkit.co/videos/preview/mixkit-groups-of-students-studying-in-the-university-41556-large.mp4', title: 'Global Community', desc: 'Join a diverse network of future leaders from across the globe.' }
                ]
            },
            placements: [],
            placementStats: { total: '', recruiters: '', highest: '' },
            sitemap: [
                { title: 'Home', url: 'index.html', desc: 'Main landing page — Hero, Features, Popular Courses', icon: 'fa-solid fa-house', priority: 'high', freq: 'weekly', isRoot: true },
                { title: 'About Us', url: 'about.html', desc: 'Campus gallery, video showcase, college history & mission', icon: 'fa-solid fa-info-circle', priority: 'high', freq: 'monthly' },
                { title: 'Courses', url: 'courses.html', desc: 'Course catalog with search & filter by category', icon: 'fa-solid fa-book-open', priority: 'high', freq: 'weekly' },
                { title: 'Faculty', url: 'faculty.html', desc: '49 faculty profiles with photos, bios & contact details', icon: 'fa-solid fa-chalkboard-user', priority: 'high', freq: 'monthly' },
                { title: 'Placement', url: 'placement.html', desc: 'Placement records, recruiters & career opportunities', icon: 'fa-solid fa-briefcase', priority: 'medium', freq: 'monthly' },
                { title: 'Contact', url: 'contact.html', desc: 'Contact form, address, phone, email & Google Maps', icon: 'fa-solid fa-envelope', priority: 'high', freq: 'monthly' },
                { title: 'Login / Register', url: 'login.html', desc: 'Student login, registration & Google sign-in', icon: 'fa-solid fa-right-to-bracket', priority: 'low', freq: 'yearly' },
                { title: 'Admin Dashboard', url: 'admin.html', desc: 'Website administration panel for managing content', icon: 'fa-solid fa-shield-halved', priority: 'low', freq: 'yearly' },
                { title: 'Sitemap', url: 'sitemap.html', desc: 'Visual website structure & XML sitemap link', icon: 'fa-solid fa-sitemap', priority: 'low', freq: 'monthly' }
            ],
            contact: {
                address: 'No-97, Kavi Lakshmisha Road, V.V. Puram, Bangalore - 560 004 Karnataka, India.',
                phone: '080-26610174 / 91 96202 25400-03',
                email: 'principal.bmsccm@gmail.com\nprincipal@bmsccm.ac.in',
                mapUrl: 'https://maps.google.com/maps?q=No-97,+Kavi+Lakshmisha+Road,+V.V.+Puram,+Bangalore+-+560+004+Karnataka,+India&t=&z=15&ie=UTF8&iwloc=&output=embed'
            }
        };
        let mediaToDelete = new Set();

        // ══════════════════════════════════════════════════
        //  UTILITY: Toggle password visibility
        // ══════════════════════════════════════════════════
        function toggleVis(inputId, btn) {
            const input = document.getElementById(inputId);
            const icon = btn.querySelector('i');
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fa-solid fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'fa-solid fa-eye';
            }
        }

        // ══════════════════════════════════════════════════
        //  LOGIN / LOGOUT
        // ══════════════════════════════════════════════════
        function login() {
            const id = document.getElementById('admin-id').value.trim();
            const pass = document.getElementById('admin-pass').value.trim();
            if (id === 'admin' && pass === 'admin') {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                document.getElementById('login-error').classList.remove('show');
                initDashboard();
            } else {
                document.getElementById('login-error').classList.add('show');
            }
        }

        // Allow enter key to login
        document.getElementById('admin-pass').addEventListener('keydown', e => {
            if (e.key === 'Enter') login();
        });

        function logout() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('admin-id').value = '';
            document.getElementById('admin-pass').value = '';
        }

        // ══════════════════════════════════════════════════
        //  TOKEN MANAGEMENT (Permanent)
        // ══════════════════════════════════════════════════
        function loadToken() {
            const t = localStorage.getItem('gh_admin_token');
            if (t) {
                document.getElementById('gh-token').value = t;
            }
            updateTokenBadge();
        }

        function saveToken() {
            const t = document.getElementById('gh-token').value.trim();
            if (!t) { showAlert('error', 'Please enter a token.'); return; }
            localStorage.setItem('gh_admin_token', t);
            updateTokenBadge();
            showAlert('success', 'Token saved permanently to this browser!');
        }

        function clearToken() {
            localStorage.removeItem('gh_admin_token');
            document.getElementById('gh-token').value = '';
            updateTokenBadge();
            showAlert('success', 'Token cleared.');
        }

        function getToken() {
            return (document.getElementById('gh-token').value.trim() || localStorage.getItem('gh_admin_token') || '').trim();
        }

        function updateTokenBadge() {
            const badge = document.getElementById('token-status-badge');
            const t = getToken();
            if (t) {
                badge.innerHTML = '<span class="token-status connected"><i class="fa-solid fa-check-circle"></i> Connected</span>';
            } else {
                badge.innerHTML = '<span class="token-status missing"><i class="fa-solid fa-xmark-circle"></i> Missing</span>';
            }
        }

        // ══════════════════════════════════════════════════
        //  ALERTS
        // ══════════════════════════════════════════════════
        function showAlert(type, msg) {
            const errEl = document.getElementById('dash-error');
            const sucEl = document.getElementById('dash-success');
            errEl.classList.remove('show');
            sucEl.classList.remove('show');

            if (type === 'error') {
                document.getElementById('dash-error-text').textContent = msg;
                errEl.classList.add('show');
                errEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            if (type === 'success') {
                document.getElementById('dash-success-text').textContent = msg;
                sucEl.classList.add('show');
            }
        }

        function hideAlerts() {
            document.getElementById('dash-error').classList.remove('show');
            document.getElementById('dash-success').classList.remove('show');
        }

        // ══════════════════════════════════════════════════
        //  PAGE SWITCHING
        // ══════════════════════════════════════════════════
        function switchPage(page) {
            document.querySelectorAll('.page-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.page-tab[data-page="${page}"]`).classList.add('active');
            document.querySelectorAll('.page-panel').forEach(p => p.classList.remove('active'));
            document.getElementById(`panel-${page}`).classList.add('active');
            hideAlerts();
        }

        // ══════════════════════════════════════════════════
        //  INIT DASHBOARD — Load from data.json (3 fallbacks)
        // ══════════════════════════════════════════════════
        const RAW_DATA_URL = `https://raw.githubusercontent.com/${REPO}/main/data.json`;

        async function tryLoadJSON() {
            // Strategy 1: Local fetch (works on GitHub Pages)
            try {
                const res = await fetch('data.json?t=' + Date.now(), { cache: 'no-store' });
                if (res.ok) {
                    const d = await res.json();
                    if (d && (d.faculty || d.courses)) return d;
                }
            } catch (e) { console.log('Local fetch failed, trying XHR...'); }

            // Strategy 2: XMLHttpRequest (works on some local file:// setups)
            try {
                const d = await new Promise((resolve, reject) => {
                    const xhr = new XMLHttpRequest();
                    xhr.open('GET', 'data.json', true);
                    xhr.onload = () => {
                        try { resolve(JSON.parse(xhr.responseText)); }
                        catch (e) { reject(e); }
                    };
                    xhr.onerror = reject;
                    xhr.send();
                });
                if (d && (d.faculty || d.courses)) return d;
            } catch (e) { console.log('XHR failed, trying GitHub raw...'); }

            // Strategy 3: Fetch from GitHub raw URL (always works when online)
            try {
                const res = await fetch(RAW_DATA_URL + '?t=' + Date.now(), { cache: 'no-store' });
                if (res.ok) {
                    const d = await res.json();
                    if (d) return d;
                }
            } catch (e) { console.log('GitHub raw fetch also failed.'); }

            return null;
        }

        async function initDashboard() {
            loadToken();
            try {
                const data = await tryLoadJSON();
                if (data) {
                    siteData.notice = data.notice || '';
                    siteData.images = Array.isArray(data.images) ? data.images : (data.image ? [data.image] : []);
                    siteData.videos = Array.isArray(data.videos) ? data.videos : (data.video ? [data.video] : []);
                    siteData.faculty = data.faculty || [];
                    siteData.courses = data.courses || [];
                    // About page data
                    if (data.about) siteData.about = { ...siteData.about, ...data.about };
                    // Placement data
                    siteData.placements = data.placements || [];
                    if (data.placementStats) siteData.placementStats = { ...siteData.placementStats, ...data.placementStats };
                    // Contact data
                    if (data.contact) siteData.contact = { ...siteData.contact, ...data.contact };
                    if (data.sitemap) siteData.sitemap = data.sitemap;

                    // Filter empties
                    siteData.images = siteData.images.filter(x => x && x.trim());
                    siteData.videos = siteData.videos.filter(x => x && x.trim());

                    document.getElementById('notice-text').value = siteData.notice;
                    renderAll();
                    console.log(`Loaded: ${siteData.faculty.length} faculty, ${siteData.courses.length} courses, ${siteData.placements.length} placements`);
                } else {
                    showAlert('error', 'Could not load site data. Check your internet connection and try again.');
                }
            } catch (e) {
                console.error('Could not load data.json', e);
                showAlert('error', 'Failed to load data: ' + e.message);
            }
        }

        // ══════════════════════════════════════════════════
        //  RENDER ALL SECTIONS
        // ══════════════════════════════════════════════════
        function renderAll() {
            renderMedia();
            renderFaculty();
            renderCourses();
            renderAbout();
            renderPlacements();
            renderContact();
            renderSitemap();
            updateStats();
        }

        function updateStats() {
            document.getElementById('stat-faculty').textContent = siteData.faculty.length;
            document.getElementById('stat-courses').textContent = siteData.courses.length;
            document.getElementById('stat-media').textContent = siteData.images.length + siteData.videos.length;
        }

        // ── Media ──────────────────────────────────────
        function renderMedia() {
            const card = document.getElementById('existing-media-card');
            const list = document.getElementById('existing-media-list');
            list.innerHTML = '';
            mediaToDelete.clear();

            if (siteData.images.length === 0 && siteData.videos.length === 0) {
                card.style.display = 'none';
                return;
            }
            card.style.display = 'block';

            siteData.images.forEach((path, i) => {
                list.innerHTML += `
                    <div class="media-item">
                        <img src="${path}?t=${Date.now()}" alt="img">
                        <div class="item-info">
                            <div class="item-name">${path.split('/').pop()}</div>
                            <div class="item-sub">Image File</div>
                        </div>
                        <button class="btn-delete-item" onclick="markMediaDelete('img', ${i}, this)"><i class="fa-solid fa-trash"></i></button>
                    </div>`;
            });

            siteData.videos.forEach((path, i) => {
                list.innerHTML += `
                    <div class="media-item">
                        <video src="${path}?t=${Date.now()}"></video>
                        <div class="item-info">
                            <div class="item-name">${path.split('/').pop()}</div>
                            <div class="item-sub">Video File</div>
                        </div>
                        <button class="btn-delete-item" onclick="markMediaDelete('vid', ${i}, this)"><i class="fa-solid fa-trash"></i></button>
                    </div>`;
            });
        }

        function markMediaDelete(type, index, btn) {
            const path = type === 'img' ? siteData.images[index] : siteData.videos[index];
            mediaToDelete.add(path);
            if (type === 'img') siteData.images.splice(index, 1);
            else siteData.videos.splice(index, 1);
            renderMedia();
            updateStats();
        }

        // ── Faculty ────────────────────────────────────
        function renderFaculty() {
            const list = document.getElementById('faculty-list');
            document.getElementById('fac-count').textContent = siteData.faculty.length;
            list.innerHTML = '';

            if (siteData.faculty.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:rgba(255,255,255,0.3); font-size:13px; padding:20px;">No faculty members yet.</p>';
                return;
            }

            siteData.faculty.forEach((fac, i) => {
                const imgSrc = fac.image && fac.image.startsWith('http') ? fac.image : (fac.image || 'images/logo.png');
                list.innerHTML += `
                    <div class="faculty-item">
                        <img src="${imgSrc}" alt="${fac.name}" onerror="this.src='images/logo.png'">
                        <div class="item-info">
                            <div class="item-name">${fac.name}</div>
                            <div class="item-sub">${fac.tag} · ${fac.category}</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn-edit-item" onclick="editFaculty(${i})" title="Edit"><i class="fa-solid fa-pen"></i></button>
                            <button class="btn-delete-item" onclick="deleteFaculty(${i})" title="Delete"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`;
            });
        }

        let editingFacultyIndex = -1;

        function editFaculty(index) {
            const fac = siteData.faculty[index];
            editingFacultyIndex = index;
            document.getElementById('fac-name').value = fac.name || '';
            document.getElementById('fac-tag').value = fac.tag || '';
            document.getElementById('fac-edu').value = fac.education || '';
            document.getElementById('fac-exp').value = fac.experience || '';
            document.getElementById('fac-email').value = fac.email || '';
            document.getElementById('fac-bio').value = fac.bio || '';
            document.getElementById('fac-category').value = fac.category || 'faculty-member';
            document.getElementById('fac-photo').value = '';

            document.getElementById('fac-form-title').innerHTML = '<i class="fa-solid fa-pen-to-square"></i> Editing: ' + fac.name + ' <span class="editing-indicator">EDITING</span>';
            document.getElementById('fac-submit-btn').innerHTML = '<i class="fa-solid fa-check"></i> Update Faculty';
            document.getElementById('fac-submit-btn').className = 'btn btn-warning';
            document.getElementById('fac-cancel-edit').style.display = 'inline';

            document.getElementById('fac-form-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function cancelEditFaculty() {
            editingFacultyIndex = -1;
            ['fac-name', 'fac-tag', 'fac-edu', 'fac-exp', 'fac-email', 'fac-bio'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('fac-photo').value = '';
            document.getElementById('fac-form-title').innerHTML = '<i class="fa-solid fa-user-plus"></i> Add New Faculty';
            document.getElementById('fac-submit-btn').innerHTML = '<i class="fa-solid fa-plus"></i> Add Faculty Member';
            document.getElementById('fac-submit-btn').className = 'btn btn-primary';
            document.getElementById('fac-cancel-edit').style.display = 'none';
        }

        function addFaculty() {
            const name = document.getElementById('fac-name').value.trim();
            const tag = document.getElementById('fac-tag').value.trim();
            const bio = document.getElementById('fac-bio').value.trim();
            const photoFile = document.getElementById('fac-photo').files[0];

            if (!name || !tag || !bio) {
                showAlert('error', 'Please fill Name, Designation, and Bio.');
                return;
            }

            // EDIT MODE: update existing faculty
            if (editingFacultyIndex >= 0) {
                const fac = siteData.faculty[editingFacultyIndex];
                fac.name = name;
                fac.tag = tag;
                fac.education = document.getElementById('fac-edu').value.trim();
                fac.experience = document.getElementById('fac-exp').value.trim();
                fac.email = document.getElementById('fac-email').value.trim();
                fac.bio = bio;
                fac.category = document.getElementById('fac-category').value;

                // If a new photo was selected, prepare for upload
                if (photoFile) {
                    const reader = new FileReader();
                    reader.onload = () => {
                        const newPath = `images/faculty_${Date.now()}.${photoFile.name.split('.').pop()}`;
                        fac.image = newPath;
                        fac._pendingUpload = reader.result.split(',')[1];
                        fac._pendingPath = newPath;
                        cancelEditFaculty();
                        renderFaculty();
                        updateStats();
                        showAlert('success', `"${name}" updated. Click Publish to save.`);
                    };
                    reader.readAsDataURL(photoFile);
                } else {
                    // Keep existing photo
                    cancelEditFaculty();
                    renderFaculty();
                    updateStats();
                    showAlert('success', `"${name}" updated. Click Publish to save.`);
                }
                return;
            }

            // ADD MODE: new faculty
            if (!photoFile) {
                showAlert('error', 'Please select a photo for the faculty member.');
                return;
            }

            const reader = new FileReader();
            reader.onload = () => {
                const newFac = {
                    name,
                    tag,
                    education: document.getElementById('fac-edu').value.trim(),
                    experience: document.getElementById('fac-exp').value.trim(),
                    email: document.getElementById('fac-email').value.trim(),
                    bio,
                    category: document.getElementById('fac-category').value,
                    image: `images/faculty_${Date.now()}.${photoFile.name.split('.').pop()}`,
                    _pendingUpload: reader.result.split(',')[1],
                    _pendingPath: `images/faculty_${Date.now()}.${photoFile.name.split('.').pop()}`
                };
                siteData.faculty.push(newFac);
                renderFaculty();
                updateStats();

                // Clear form
                ['fac-name', 'fac-tag', 'fac-edu', 'fac-exp', 'fac-email', 'fac-bio'].forEach(id => document.getElementById(id).value = '');
                document.getElementById('fac-photo').value = '';
                showAlert('success', `Faculty member "${name}" added. Click Publish to save.`);
            };
            reader.readAsDataURL(photoFile);
        }

        function deleteFaculty(index) {
            const name = siteData.faculty[index].name;
            if (confirm(`Remove "${name}" from faculty?`)) {
                // If image is a local path, mark for deletion
                const img = siteData.faculty[index].image;
                if (img && !img.startsWith('http')) {
                    mediaToDelete.add(img);
                }
                siteData.faculty.splice(index, 1);
                renderFaculty();
                updateStats();
                showAlert('success', `"${name}" removed. Click Publish to save.`);
            }
        }

        // ── Courses ────────────────────────────────────
        function renderCourses() {
            const list = document.getElementById('courses-list');
            document.getElementById('course-count').textContent = siteData.courses.length;
            list.innerHTML = '';

            if (siteData.courses.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:rgba(255,255,255,0.3); font-size:13px; padding:20px;">No courses yet.</p>';
                return;
            }

            siteData.courses.forEach((c, i) => {
                list.innerHTML += `
                    <div class="course-item">
                        <div class="item-info">
                            <div class="item-name">${c.title}</div>
                            <div class="item-sub">${c.category.toUpperCase()} · ${c.description.substring(0, 60)}...</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn-edit-item" onclick="editCourse(${i})" title="Edit"><i class="fa-solid fa-pen"></i></button>
                            <button class="btn-delete-item" onclick="deleteCourse(${i})" title="Delete"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`;
            });
        }

        let editingCourseIndex = -1;

        function editCourse(index) {
            const c = siteData.courses[index];
            editingCourseIndex = index;
            document.getElementById('course-title').value = c.title || '';
            document.getElementById('course-desc').value = c.description || '';
            document.getElementById('course-cat').value = c.category || 'bca';
            document.getElementById('course-img').value = c.image || '';

            document.getElementById('course-form-title').innerHTML = '<i class="fa-solid fa-pen-to-square"></i> Editing: ' + c.title + ' <span class="editing-indicator">EDITING</span>';
            document.getElementById('course-submit-btn').innerHTML = '<i class="fa-solid fa-check"></i> Update Course';
            document.getElementById('course-submit-btn').className = 'btn btn-warning';
            document.getElementById('course-cancel-edit').style.display = 'inline';

            document.getElementById('course-form-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function cancelEditCourse() {
            editingCourseIndex = -1;
            document.getElementById('course-title').value = '';
            document.getElementById('course-desc').value = '';
            document.getElementById('course-img').value = '';
            document.getElementById('course-img-file').value = '';
            document.getElementById('course-form-title').innerHTML = '<i class="fa-solid fa-circle-plus"></i> Add New Course';
            document.getElementById('course-submit-btn').innerHTML = '<i class="fa-solid fa-plus"></i> Add Course';
            document.getElementById('course-submit-btn').className = 'btn btn-primary';
            document.getElementById('course-cancel-edit').style.display = 'none';
        }

        function addCourse() {
            const title = document.getElementById('course-title').value.trim();
            const desc = document.getElementById('course-desc').value.trim();
            const cat = document.getElementById('course-cat').value;
            let img = document.getElementById('course-img').value.trim();
            const imgFile = document.getElementById('course-img-file').files[0];

            if (!title || !desc) {
                showAlert('error', 'Please fill Course Title and Description.');
                return;
            }

            // Default images per category
            const defaultImages = {
                bca: 'https://images.unsplash.com/photo-1517694712202-14dd9538aa97?q=80&w=2070&auto=format&fit=crop',
                bba: 'https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?q=80&w=2070&auto=format&fit=crop',
                bcom: 'https://images.unsplash.com/photo-1554224155-6726b3ff858f?q=80&w=2071&auto=format&fit=crop',
                management: 'https://images.unsplash.com/photo-1552664730-d307ca884978?q=80&w=2070&auto=format&fit=crop'
            };

            // If file uploaded, read and store as pending
            if (imgFile) {
                const reader = new FileReader();
                reader.onload = () => {
                    const path = `images/course_${Date.now()}.${imgFile.name.split('.').pop()}`;
                    const courseObj = { title, description: desc, image: path, category: cat, _pendingUpload: reader.result.split(',')[1], _pendingPath: path };
                    if (editingCourseIndex >= 0) {
                        siteData.courses[editingCourseIndex] = courseObj;
                        cancelEditCourse();
                    } else {
                        siteData.courses.push(courseObj);
                        document.getElementById('course-title').value = '';
                        document.getElementById('course-desc').value = '';
                        document.getElementById('course-img').value = '';
                        document.getElementById('course-img-file').value = '';
                    }
                    renderCourses(); updateStats();
                    showAlert('success', `Course "${title}" ${editingCourseIndex >= 0 ? 'updated' : 'added'}. Click Publish to save.`);
                };
                reader.readAsDataURL(imgFile);
                return;
            }

            if (!img) img = defaultImages[cat] || defaultImages.bca;

            // EDIT MODE
            if (editingCourseIndex >= 0) {
                siteData.courses[editingCourseIndex] = { title, description: desc, image: img, category: cat };
                cancelEditCourse();
                renderCourses();
                updateStats();
                showAlert('success', `"${title}" updated. Click Publish to save.`);
                return;
            }

            // ADD MODE
            siteData.courses.push({ title, description: desc, image: img, category: cat });
            renderCourses();
            updateStats();

            document.getElementById('course-title').value = '';
            document.getElementById('course-desc').value = '';
            document.getElementById('course-img').value = '';
            document.getElementById('course-img-file').value = '';
            showAlert('success', `Course "${title}" added. Click Publish to save.`);
        }

        function deleteCourse(index) {
            const title = siteData.courses[index].title;
            if (confirm(`Remove "${title}"?`)) {
                siteData.courses.splice(index, 1);
                renderCourses();
                updateStats();
                showAlert('success', `"${title}" removed. Click Publish to save.`);
            }
        }

        // ══════════════════════════════════════════════════
        //  ABOUT PAGE FUNCTIONS
        // ══════════════════════════════════════════════════
        function renderAbout() {
            const a = siteData.about;
            document.getElementById('about-heading').value = a.heading || '';
            document.getElementById('about-para1').value = a.para1 || '';
            document.getElementById('about-para2').value = a.para2 || '';
            if (a.cards && a.cards.length >= 3) {
                for (let i = 0; i < 3; i++) {
                    document.getElementById(`about-card${i + 1}-title`).value = a.cards[i].title || '';
                    document.getElementById(`about-card${i + 1}-desc`).value = a.cards[i].desc || '';
                    document.getElementById(`about-card${i + 1}-icon`).value = a.cards[i].icon || '';
                }
            }
            renderGalleryItems();
            renderAboutVideos();
        }

        function collectAboutData() {
            return {
                heading: document.getElementById('about-heading').value.trim(),
                para1: document.getElementById('about-para1').value.trim(),
                para2: document.getElementById('about-para2').value.trim(),
                cards: [0, 1, 2].map(i => ({
                    title: document.getElementById(`about-card${i + 1}-title`).value.trim(),
                    desc: document.getElementById(`about-card${i + 1}-desc`).value.trim(),
                    icon: document.getElementById(`about-card${i + 1}-icon`).value.trim() || 'fa-solid fa-star'
                })),
                gallery: (siteData.about.gallery || []).map(g => ({ image: g.image, icon: g.icon, title: g.title, sub: g.sub })),
                aboutVideos: (siteData.about.aboutVideos || []).map(v => ({ src: v.src, title: v.title, desc: v.desc }))
            };
        }

        // ── Gallery Items (About page) ────────────────
        function renderGalleryItems() {
            const list = document.getElementById('gallery-list');
            const items = siteData.about.gallery || [];
            document.getElementById('gallery-count').textContent = items.length;
            list.innerHTML = '';
            if (items.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:rgba(255,255,255,0.3); font-size:13px; padding:20px;">No gallery images yet.</p>';
                return;
            }
            items.forEach((g, i) => {
                list.innerHTML += `
                    <div class="course-item">
                        <div class="item-info">
                            <div class="item-name"><i class="${g.icon}" style="margin-right:6px; color:#667eea;"></i> ${g.title}</div>
                            <div class="item-sub">${g.sub} · ${g.image.substring(0, 50)}...</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn-edit-item" onclick="editGalleryItem(${i})" title="Edit"><i class="fa-solid fa-pen"></i></button>
                            <button class="btn-delete-item" onclick="deleteGalleryItem(${i})" title="Delete"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`;
            });
        }

        let editingGalleryIndex = -1;

        function editGalleryItem(index) {
            const g = siteData.about.gallery[index];
            editingGalleryIndex = index;
            document.getElementById('gallery-img').value = g.image || '';
            document.getElementById('gallery-icon').value = g.icon || '';
            document.getElementById('gallery-title').value = g.title || '';
            document.getElementById('gallery-sub').value = g.sub || '';
            document.getElementById('about-gallery-form-title').innerHTML = '<i class="fa-solid fa-pen-to-square"></i> Editing: ' + g.title + ' <span class="editing-indicator">EDITING</span>';
            document.getElementById('gallery-submit-btn').innerHTML = '<i class="fa-solid fa-check"></i> Update Gallery Image';
            document.getElementById('gallery-submit-btn').className = 'btn btn-warning';
            document.getElementById('gallery-cancel-edit').style.display = 'inline';
            document.getElementById('about-gallery-form-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function cancelEditGallery() {
            editingGalleryIndex = -1;
            ['gallery-img', 'gallery-icon', 'gallery-title', 'gallery-sub'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('gallery-img-file').value = '';
            document.getElementById('about-gallery-form-title').innerHTML = '<i class="fa-solid fa-images"></i> Add Gallery Image';
            document.getElementById('gallery-submit-btn').innerHTML = '<i class="fa-solid fa-plus"></i> Add Gallery Image';
            document.getElementById('gallery-submit-btn').className = 'btn btn-primary';
            document.getElementById('gallery-cancel-edit').style.display = 'none';
        }

        function addGalleryItem() {
            let image = document.getElementById('gallery-img').value.trim();
            const icon = document.getElementById('gallery-icon').value.trim();
            const title = document.getElementById('gallery-title').value.trim();
            const sub = document.getElementById('gallery-sub').value.trim();
            const imgFile = document.getElementById('gallery-img-file').files[0];

            if (!icon || !title || !sub) {
                showAlert('error', 'Please fill Icon, Title, and Subtitle.'); return;
            }
            if (!image && !imgFile) {
                showAlert('error', 'Please provide an Image URL or upload a file.'); return;
            }
            if (!siteData.about.gallery) siteData.about.gallery = [];

            // If file uploaded, read and store as pending
            if (imgFile) {
                const reader = new FileReader();
                reader.onload = () => {
                    const path = `images/gallery_${Date.now()}.${imgFile.name.split('.').pop()}`;
                    const item = { image: path, icon, title, sub, _pendingUpload: reader.result.split(',')[1], _pendingPath: path };
                    if (editingGalleryIndex >= 0) {
                        siteData.about.gallery[editingGalleryIndex] = item;
                        cancelEditGallery();
                    } else {
                        siteData.about.gallery.push(item);
                        ['gallery-img', 'gallery-icon', 'gallery-title', 'gallery-sub'].forEach(id => document.getElementById(id).value = '');
                        document.getElementById('gallery-img-file').value = '';
                    }
                    renderGalleryItems();
                    showAlert('success', `Gallery image "${title}" ${editingGalleryIndex >= 0 ? 'updated' : 'added'}. Click Publish to save.`);
                };
                reader.readAsDataURL(imgFile);
                return;
            }

            // URL mode
            if (editingGalleryIndex >= 0) {
                siteData.about.gallery[editingGalleryIndex] = { image, icon, title, sub };
                cancelEditGallery();
                renderGalleryItems();
                showAlert('success', `Gallery image "${title}" updated. Click Publish to save.`);
                return;
            }
            siteData.about.gallery.push({ image, icon, title, sub });
            ['gallery-img', 'gallery-icon', 'gallery-title', 'gallery-sub'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('gallery-img-file').value = '';
            renderGalleryItems();
            showAlert('success', `Gallery image "${title}" added. Click Publish to save.`);
        }

        function deleteGalleryItem(index) {
            const title = siteData.about.gallery[index].title;
            if (confirm(`Remove gallery image "${title}"?`)) {
                siteData.about.gallery.splice(index, 1);
                renderGalleryItems();
                showAlert('success', `"${title}" removed. Click Publish to save.`);
            }
        }

        // ── About Videos (Campus Pulse) ────────────────
        function renderAboutVideos() {
            const list = document.getElementById('about-vid-list');
            const items = siteData.about.aboutVideos || [];
            document.getElementById('about-vid-count').textContent = items.length;
            list.innerHTML = '';
            if (items.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:rgba(255,255,255,0.3); font-size:13px; padding:20px;">No video cards yet.</p>';
                return;
            }
            items.forEach((v, i) => {
                list.innerHTML += `
                    <div class="course-item">
                        <div class="item-info">
                            <div class="item-name"><i class="fa-solid fa-video" style="margin-right:6px; color:#667eea;"></i> ${v.title}</div>
                            <div class="item-sub">${v.desc.substring(0, 50)}... · ${v.src.substring(0, 40)}...</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn-edit-item" onclick="editAboutVideo(${i})" title="Edit"><i class="fa-solid fa-pen"></i></button>
                            <button class="btn-delete-item" onclick="deleteAboutVideo(${i})" title="Delete"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`;
            });
        }

        let editingAboutVideoIndex = -1;

        function editAboutVideo(index) {
            const v = siteData.about.aboutVideos[index];
            editingAboutVideoIndex = index;
            document.getElementById('about-vid-src').value = v.src || '';
            document.getElementById('about-vid-title').value = v.title || '';
            document.getElementById('about-vid-desc').value = v.desc || '';
            document.getElementById('about-video-form-title').innerHTML = '<i class="fa-solid fa-pen-to-square"></i> Editing: ' + v.title + ' <span class="editing-indicator">EDITING</span>';
            document.getElementById('about-vid-submit-btn').innerHTML = '<i class="fa-solid fa-check"></i> Update Video Card';
            document.getElementById('about-vid-submit-btn').className = 'btn btn-warning';
            document.getElementById('about-vid-cancel-edit').style.display = 'inline';
            document.getElementById('about-video-form-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function cancelEditAboutVideo() {
            editingAboutVideoIndex = -1;
            ['about-vid-src', 'about-vid-title', 'about-vid-desc'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('about-vid-file').value = '';
            document.getElementById('about-video-form-title').innerHTML = '<i class="fa-solid fa-film"></i> Add Video Card';
            document.getElementById('about-vid-submit-btn').innerHTML = '<i class="fa-solid fa-plus"></i> Add Video Card';
            document.getElementById('about-vid-submit-btn').className = 'btn btn-primary';
            document.getElementById('about-vid-cancel-edit').style.display = 'none';
        }

        function addAboutVideo() {
            let src = document.getElementById('about-vid-src').value.trim();
            const title = document.getElementById('about-vid-title').value.trim();
            const desc = document.getElementById('about-vid-desc').value.trim();
            const vidFile = document.getElementById('about-vid-file').files[0];

            if (!title || !desc) {
                showAlert('error', 'Please fill Title and Description.'); return;
            }
            if (!src && !vidFile) {
                showAlert('error', 'Please provide a Video URL or upload a file.'); return;
            }
            if (!siteData.about.aboutVideos) siteData.about.aboutVideos = [];

            // If file uploaded
            if (vidFile) {
                const reader = new FileReader();
                reader.onload = () => {
                    const path = `video/about_${Date.now()}.${vidFile.name.split('.').pop()}`;
                    const item = { src: path, title, desc, _pendingUpload: reader.result.split(',')[1], _pendingPath: path };
                    if (editingAboutVideoIndex >= 0) {
                        siteData.about.aboutVideos[editingAboutVideoIndex] = item;
                        cancelEditAboutVideo();
                    } else {
                        siteData.about.aboutVideos.push(item);
                        ['about-vid-src', 'about-vid-title', 'about-vid-desc'].forEach(id => document.getElementById(id).value = '');
                        document.getElementById('about-vid-file').value = '';
                    }
                    renderAboutVideos();
                    showAlert('success', `Video card "${title}" ${editingAboutVideoIndex >= 0 ? 'updated' : 'added'}. Click Publish to save.`);
                };
                reader.readAsDataURL(vidFile);
                return;
            }

            // URL mode
            if (editingAboutVideoIndex >= 0) {
                siteData.about.aboutVideos[editingAboutVideoIndex] = { src, title, desc };
                cancelEditAboutVideo();
                renderAboutVideos();
                showAlert('success', `Video card "${title}" updated. Click Publish to save.`);
                return;
            }
            siteData.about.aboutVideos.push({ src, title, desc });
            ['about-vid-src', 'about-vid-title', 'about-vid-desc'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('about-vid-file').value = '';
            renderAboutVideos();
            showAlert('success', `Video card "${title}" added. Click Publish to save.`);
        }

        function deleteAboutVideo(index) {
            const title = siteData.about.aboutVideos[index].title;
            if (confirm(`Remove video card "${title}"?`)) {
                siteData.about.aboutVideos.splice(index, 1);
                renderAboutVideos();
                showAlert('success', `"${title}" removed. Click Publish to save.`);
            }
        }

        // ══════════════════════════════════════════════════
        //  SITEMAP FUNCTIONS
        // ══════════════════════════════════════════════════
        function renderSitemap() {
            const list = document.getElementById('sitemap-list');
            const items = siteData.sitemap || [];
            document.getElementById('sm-count').textContent = items.length;
            list.innerHTML = '';
            if (items.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:rgba(255,255,255,0.3); font-size:13px; padding:20px;">No sitemap entries yet.</p>';
                return;
            }
            items.forEach((s, i) => {
                const hiddenStyle = s.hidden ? 'opacity: 0.45;' : '';
                const hiddenBadge = s.hidden ? ' <span style="color:#ffc107; font-size:10px; font-weight:700;"><i class="fa-solid fa-eye-slash"></i> HIDDEN</span>' : '';
                const rootBadge = s.isRoot ? ' <span style="color:#667eea; font-size:10px; font-weight:700;"><i class="fa-solid fa-star"></i> ROOT</span>' : '';
                const toggleIcon = s.hidden ? 'fa-eye' : 'fa-eye-slash';
                const toggleTitle = s.hidden ? 'Show on website' : 'Temporarily hide';
                const priorityLabel = s.priority === 'high' ? '🟢 High' : s.priority === 'medium' ? '🟡 Medium' : '🟣 Low';
                list.innerHTML += `
                    <div class="course-item" style="${hiddenStyle}">
                        <div class="item-info">
                            <div class="item-name"><i class="${s.icon}" style="margin-right:6px; color:#667eea;"></i> ${s.title}${rootBadge}${hiddenBadge}</div>
                            <div class="item-sub">${s.url} · ${priorityLabel} · ${s.freq}</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn-edit-item" onclick="editSitemap(${i})" title="Edit"><i class="fa-solid fa-pen"></i></button>
                            <button class="btn-edit-item" onclick="toggleSitemapHidden(${i})" title="${toggleTitle}" style="color:#ffc107;"><i class="fa-solid ${toggleIcon}"></i></button>
                            <button class="btn-delete-item" onclick="deleteSitemapEntry(${i})" title="Permanently Delete"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`;
            });
        }

        let editingSitemapIndex = -1;

        function editSitemap(index) {
            const s = siteData.sitemap[index];
            editingSitemapIndex = index;
            document.getElementById('sm-title').value = s.title || '';
            document.getElementById('sm-url').value = s.url || '';
            document.getElementById('sm-desc').value = s.desc || '';
            document.getElementById('sm-icon').value = s.icon || '';
            document.getElementById('sm-priority').value = s.priority || 'high';
            document.getElementById('sm-freq').value = s.freq || 'monthly';
            document.getElementById('sitemap-form-title').innerHTML = '<i class="fa-solid fa-pen-to-square"></i> Editing: ' + s.title + ' <span class="editing-indicator">EDITING</span>';
            document.getElementById('sm-submit-btn').innerHTML = '<i class="fa-solid fa-check"></i> Update Entry';
            document.getElementById('sm-submit-btn').className = 'btn btn-warning';
            document.getElementById('sm-cancel-edit').style.display = 'inline';
            document.getElementById('sitemap-form-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function cancelEditSitemap() {
            editingSitemapIndex = -1;
            ['sm-title', 'sm-url', 'sm-desc', 'sm-icon'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('sm-priority').value = 'high';
            document.getElementById('sm-freq').value = 'weekly';
            document.getElementById('sitemap-form-title').innerHTML = '<i class="fa-solid fa-circle-plus"></i> Add Sitemap Entry';
            document.getElementById('sm-submit-btn').innerHTML = '<i class="fa-solid fa-plus"></i> Add Entry';
            document.getElementById('sm-submit-btn').className = 'btn btn-primary';
            document.getElementById('sm-cancel-edit').style.display = 'none';
        }

        function addSitemapEntry() {
            const title = document.getElementById('sm-title').value.trim();
            const url = document.getElementById('sm-url').value.trim();
            const desc = document.getElementById('sm-desc').value.trim();
            const icon = document.getElementById('sm-icon').value.trim();
            const priority = document.getElementById('sm-priority').value;
            const freq = document.getElementById('sm-freq').value;
            if (!title || !url || !desc || !icon) {
                showAlert('error', 'Please fill Title, URL, Description, and Icon.');
                return;
            }
            const entry = { title, url, desc, icon, priority, freq };

            if (editingSitemapIndex >= 0) {
                // Preserve isRoot and hidden flags during edit
                if (siteData.sitemap[editingSitemapIndex].isRoot) entry.isRoot = true;
                if (siteData.sitemap[editingSitemapIndex].hidden) entry.hidden = true;
                siteData.sitemap[editingSitemapIndex] = entry;
                cancelEditSitemap();
                renderSitemap();
                showAlert('success', `"${title}" updated. Click Publish to save.`);
                return;
            }
            siteData.sitemap.push(entry);
            ['sm-title', 'sm-url', 'sm-desc', 'sm-icon'].forEach(id => document.getElementById(id).value = '');
            renderSitemap();
            showAlert('success', `Sitemap entry "${title}" added. Click Publish to save.`);
        }

        function toggleSitemapHidden(index) {
            const s = siteData.sitemap[index];
            s.hidden = !s.hidden;
            renderSitemap();
            const msg = s.hidden
                ? `"${s.title}" is now HIDDEN. It won't appear on the sitemap pages. Click Publish to save.`
                : `"${s.title}" is now VISIBLE again. Click Publish to save.`;
            showAlert('success', msg);
        }

        function deleteSitemapEntry(index) {
            const title = siteData.sitemap[index].title;
            if (confirm(`PERMANENTLY delete "${title}" from the sitemap? Use the eye icon to temporarily hide instead.`)) {
                siteData.sitemap.splice(index, 1);
                renderSitemap();
                showAlert('success', `"${title}" permanently removed. Click Publish to save.`);
            }
        }

        // ══════════════════════════════════════════════════
        //  PLACEMENT FUNCTIONS
        // ══════════════════════════════════════════════════
        function renderPlacements() {
            const list = document.getElementById('placement-list');
            document.getElementById('place-count').textContent = siteData.placements.length;
            // Stats
            document.getElementById('place-stat-total').value = siteData.placementStats.total || '';
            document.getElementById('place-stat-recruiters').value = siteData.placementStats.recruiters || '';
            document.getElementById('place-stat-highest').value = siteData.placementStats.highest || '';
            list.innerHTML = '';
            if (siteData.placements.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:rgba(255,255,255,0.3); font-size:13px; padding:20px;">No placement records yet.</p>';
                return;
            }
            siteData.placements.forEach((p, i) => {
                list.innerHTML += `
                    <div class="course-item">
                        <div class="item-info">
                            <div class="item-name">${p.name} — ${p.company}</div>
                            <div class="item-sub">${p.role || ''} · ${p.package || ''} · ${p.year || ''} · ${p.dept || ''}</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn-edit-item" onclick="editPlacement(${i})" title="Edit"><i class="fa-solid fa-pen"></i></button>
                            <button class="btn-delete-item" onclick="deletePlacement(${i})" title="Delete"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`;
            });
        }

        let editingPlacementIndex = -1;

        function editPlacement(index) {
            const p = siteData.placements[index];
            editingPlacementIndex = index;
            document.getElementById('place-name').value = p.name || '';
            document.getElementById('place-company').value = p.company || '';
            document.getElementById('place-role').value = p.role || '';
            document.getElementById('place-package').value = p.package || '';
            document.getElementById('place-year').value = p.year || '';
            document.getElementById('place-dept').value = p.dept || '';

            document.getElementById('place-form-title').innerHTML = '<i class="fa-solid fa-pen-to-square"></i> Editing: ' + p.name + ' <span class="editing-indicator">EDITING</span>';
            document.getElementById('place-submit-btn').innerHTML = '<i class="fa-solid fa-check"></i> Update Record';
            document.getElementById('place-submit-btn').className = 'btn btn-warning';
            document.getElementById('place-cancel-edit').style.display = 'inline';

            document.getElementById('place-form-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function cancelEditPlacement() {
            editingPlacementIndex = -1;
            ['place-name', 'place-company', 'place-role', 'place-package', 'place-year', 'place-dept'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('place-form-title').innerHTML = '<i class="fa-solid fa-user-tie"></i> Add Placement Record';
            document.getElementById('place-submit-btn').innerHTML = '<i class="fa-solid fa-plus"></i> Add Placement Record';
            document.getElementById('place-submit-btn').className = 'btn btn-primary';
            document.getElementById('place-cancel-edit').style.display = 'none';
        }

        function addPlacement() {
            const name = document.getElementById('place-name').value.trim();
            const company = document.getElementById('place-company').value.trim();
            if (!name || !company) { showAlert('error', 'Student Name and Company are required.'); return; }

            const record = {
                name,
                company,
                role: document.getElementById('place-role').value.trim(),
                package: document.getElementById('place-package').value.trim(),
                year: document.getElementById('place-year').value.trim(),
                dept: document.getElementById('place-dept').value.trim()
            };

            // EDIT MODE
            if (editingPlacementIndex >= 0) {
                siteData.placements[editingPlacementIndex] = record;
                cancelEditPlacement();
                renderPlacements();
                showAlert('success', `"${name}" updated. Click Publish to save.`);
                return;
            }

            // ADD MODE
            siteData.placements.push(record);
            ['place-name', 'place-company', 'place-role', 'place-package', 'place-year', 'place-dept'].forEach(id => document.getElementById(id).value = '');
            renderPlacements();
            showAlert('success', `Placement record for "${name}" added. Click Publish to save.`);
        }

        function deletePlacement(index) {
            const n = siteData.placements[index].name;
            if (confirm(`Remove placement record for "${n}"?`)) {
                siteData.placements.splice(index, 1);
                renderPlacements();
                showAlert('success', `"${n}" removed. Click Publish to save.`);
            }
        }

        // ══════════════════════════════════════════════════
        //  CONTACT FUNCTIONS
        // ══════════════════════════════════════════════════
        function renderContact() {
            const c = siteData.contact;
            document.getElementById('contact-address').value = c.address || '';
            document.getElementById('contact-phone').value = c.phone || '';
            document.getElementById('contact-email').value = c.email || '';
            document.getElementById('contact-map').value = c.mapUrl || '';
        }

        function collectContactData() {
            return {
                address: document.getElementById('contact-address').value.trim(),
                phone: document.getElementById('contact-phone').value.trim(),
                email: document.getElementById('contact-email').value.trim(),
                mapUrl: document.getElementById('contact-map').value.trim()
            };
        }

        // ══════════════════════════════════════════════════
        //  GITHUB API HELPERS
        // ══════════════════════════════════════════════════
        function getBase64(file) {
            return new Promise((resolve, reject) => {
                const r = new FileReader();
                r.onload = () => resolve(r.result.split(',')[1]);
                r.onerror = reject;
                r.readAsDataURL(file);
            });
        }

        async function ghUpload(token, path, base64Content) {
            const url = `https://api.github.com/repos/${REPO}/contents/${path}`;
            const headers = { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' };

            let sha = null;
            try {
                const r = await fetch(url, { headers });
                if (r.ok) sha = (await r.json()).sha;
            } catch (e) { }

            const body = { message: `Admin Update: ${path}`, content: base64Content };
            if (sha) body.sha = sha;

            const res = await fetch(url, { method: 'PUT', headers, body: JSON.stringify(body) });
            if (!res.ok) {
                const err = await res.json();
                throw new Error(err.message || 'Upload failed');
            }
            return res.json();
        }

        async function ghDelete(token, path) {
            const url = `https://api.github.com/repos/${REPO}/contents/${path}`;
            const headers = { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' };
            try {
                const r = await fetch(url, { headers });
                if (r.ok) {
                    const sha = (await r.json()).sha;
                    await fetch(url, { method: 'DELETE', headers, body: JSON.stringify({ message: `Admin Delete: ${path}`, sha }) });
                }
            } catch (e) {
                console.warn('Could not delete:', path);
            }
        }

        // ══════════════════════════════════════════════════
        //  PUBLISH ALL CHANGES
        // ══════════════════════════════════════════════════
        async function publishChanges() {
            const token = getToken();
            if (!token) {
                showAlert('error', 'Please save a GitHub Personal Access Token first.');
                return;
            }

            // Auto-save token on publish
            localStorage.setItem('gh_admin_token', token);
            updateTokenBadge();

            const btn = document.getElementById('publish-btn');
            const spinner = document.getElementById('publish-spinner');
            const icon = document.getElementById('publish-icon');
            const text = document.getElementById('publish-text');

            btn.disabled = true;
            spinner.style.display = 'inline-block';
            icon.style.display = 'none';
            text.textContent = 'Publishing...';
            hideAlerts();

            try {
                // 1. Upload pending faculty photos
                for (let fac of siteData.faculty) {
                    if (fac._pendingUpload) {
                        text.textContent = `Uploading photo: ${fac.name}...`;
                        await ghUpload(token, fac._pendingPath, fac._pendingUpload);
                        delete fac._pendingUpload;
                        delete fac._pendingPath;
                    }
                }

                // 1b. Upload pending course images
                for (let course of siteData.courses) {
                    if (course._pendingUpload) {
                        text.textContent = `Uploading course image: ${course.title}...`;
                        await ghUpload(token, course._pendingPath, course._pendingUpload);
                        delete course._pendingUpload;
                        delete course._pendingPath;
                    }
                }

                // 1c. Upload pending gallery images (About page)
                if (siteData.about.gallery) {
                    for (let g of siteData.about.gallery) {
                        if (g._pendingUpload) {
                            text.textContent = `Uploading gallery image: ${g.title}...`;
                            await ghUpload(token, g._pendingPath, g._pendingUpload);
                            delete g._pendingUpload;
                            delete g._pendingPath;
                        }
                    }
                }

                // 1d. Upload pending about videos
                if (siteData.about.aboutVideos) {
                    for (let v of siteData.about.aboutVideos) {
                        if (v._pendingUpload) {
                            text.textContent = `Uploading video: ${v.title}...`;
                            await ghUpload(token, v._pendingPath, v._pendingUpload);
                            delete v._pendingUpload;
                            delete v._pendingPath;
                        }
                    }
                }

                // 2. Upload new home images
                const imgFile = document.getElementById('image-upload').files[0];
                if (imgFile) {
                    text.textContent = 'Uploading image...';
                    const b64 = await getBase64(imgFile);
                    const path = `images/dynamic_${Date.now()}.${imgFile.name.split('.').pop()}`;
                    await ghUpload(token, path, b64);
                    siteData.images.push(path);
                }

                // 3. Upload new home videos
                const vidFile = document.getElementById('video-upload').files[0];
                if (vidFile) {
                    text.textContent = 'Uploading video...';
                    const b64 = await getBase64(vidFile);
                    const path = `video/dynamic_${Date.now()}.${vidFile.name.split('.').pop()}`;
                    await ghUpload(token, path, b64);
                    siteData.videos.push(path);
                }

                // 4. Delete removed media from GitHub
                for (let path of mediaToDelete) {
                    text.textContent = `Deleting: ${path.split('/').pop()}...`;
                    await ghDelete(token, path);
                }

                // 5. Build final data.json
                siteData.notice = document.getElementById('notice-text').value;

                // Clean internal fields before saving
                const cleanFaculty = siteData.faculty.map(f => ({
                    name: f.name,
                    tag: f.tag,
                    education: f.education || '',
                    experience: f.experience || '',
                    email: f.email || '',
                    bio: f.bio,
                    image: f.image,
                    category: f.category
                }));

                // Clean course internal fields
                const cleanCourses = siteData.courses.map(c => ({
                    title: c.title,
                    description: c.description,
                    image: c.image,
                    category: c.category
                }));

                // Collect About + Contact from form fields
                siteData.about = collectAboutData();
                siteData.contact = collectContactData();
                siteData.placementStats = {
                    total: document.getElementById('place-stat-total').value.trim(),
                    recruiters: document.getElementById('place-stat-recruiters').value.trim(),
                    highest: document.getElementById('place-stat-highest').value.trim()
                };

                const finalData = {
                    notice: siteData.notice,
                    images: siteData.images,
                    videos: siteData.videos,
                    faculty: cleanFaculty,
                    courses: cleanCourses,
                    about: siteData.about,
                    placements: siteData.placements,
                    placementStats: siteData.placementStats,
                    contact: siteData.contact,
                    sitemap: siteData.sitemap
                };

                text.textContent = 'Saving data.json...';
                const dataStr = unescape(encodeURIComponent(JSON.stringify(finalData, null, 2)));
                const dataB64 = btoa(dataStr);
                await ghUpload(token, 'data.json', dataB64);

                // 6. Now regenerate faculty.html and courses.html
                text.textContent = 'Rebuilding faculty page...';
                await rebuildFacultyPage(token, cleanFaculty);

                text.textContent = 'Rebuilding courses page...';
                await rebuildCoursesPage(token, siteData.courses);

                text.textContent = 'Rebuilding about page...';
                await rebuildAboutPage(token, siteData.about);

                text.textContent = 'Rebuilding placement page...';
                await rebuildPlacementPage(token, siteData.placements, siteData.placementStats);

                text.textContent = 'Rebuilding contact page...';
                await rebuildContactPage(token, siteData.contact);

                text.textContent = 'Rebuilding sitemap...';
                await rebuildSitemapPage(token, siteData.sitemap);
                await rebuildSitemapXml(token, siteData.sitemap);

                // Done
                showAlert('success', '✅ All changes published successfully! Pages will update shortly.');
                document.getElementById('image-upload').value = '';
                document.getElementById('video-upload').value = '';
                mediaToDelete.clear();
                siteData.faculty = cleanFaculty;
                renderAll();

            } catch (e) {
                console.error(e);
                showAlert('error', 'Error: ' + e.message);
            } finally {
                btn.disabled = false;
                spinner.style.display = 'none';
                icon.style.display = 'inline-block';
                text.textContent = 'Publish All Changes';
            }
        }

        // ══════════════════════════════════════════════════
        //  REBUILD FACULTY PAGE HTML
        // ══════════════════════════════════════════════════
        async function rebuildFacultyPage(token, faculty) {
            // Fetch current faculty.html to get the template
            const url = `https://api.github.com/repos/${REPO}/contents/faculty.html`;
            const headers = { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' };

            const res = await fetch(url, { headers });
            if (!res.ok) throw new Error('Could not fetch faculty.html');
            const fileData = await res.json();
            const currentHtml = atob(fileData.content.replace(/\n/g, ''));

            // Find the features-grid content and replace
            const gridStart = currentHtml.indexOf('<div class="features-grid">');
            const gridEnd = currentHtml.indexOf('</div>\r\n    </section>', gridStart) || currentHtml.indexOf('</div>\n    </section>', gridStart);

            if (gridStart === -1) throw new Error('Could not find features-grid in faculty.html');

            // Build faculty cards HTML
            let cardsHtml = '\n';
            faculty.forEach(fac => {
                const emailHtml = fac.email ? `<a class="profile-email" href="mailto:${fac.email}"><i class="fa-solid fa-envelope"></i> ${fac.email}</a>` : '';
                cardsHtml += `                <div class="profile-card scroll-reveal" data-category="${fac.category}">
                    <div class="profile-card-image">
                        <img alt="${fac.name}" src="${fac.image}" />
                    </div>
                    <div class="profile-card-content">
                        <span class="profile-tag">${fac.tag}</span>
                        <h3>${fac.name}</h3>${emailHtml}
                        <p>${fac.education}</p>
                        <p>${fac.bio.substring(0, 100)}${fac.bio.length > 100 ? '...' : ''}</p>
                        <button class="btn-know-more-card"
                            data-bio="${fac.bio.replace(/"/g, '&quot;')}"
                            data-edu="${fac.education}" data-email="${fac.email}" data-exp="${fac.experience}"
                            data-img="${fac.image}" data-name="${fac.name}"
                            data-tag="${fac.tag}">
                            Know More <i class="fa-solid fa-arrow-right"></i>
                        </button>
                    </div>
                </div>\n`;
            });

            // Find end of grid more carefully
            const closingTag = '</div>\r\n        </div>\r\n    </section>';
            const closingTagLF = '</div>\n        </div>\n    </section>';
            let actualEnd = currentHtml.indexOf(closingTag, gridStart + 30);
            let useClosing = closingTag;
            if (actualEnd === -1) {
                actualEnd = currentHtml.indexOf(closingTagLF, gridStart + 30);
                useClosing = closingTagLF;
            }

            // The features-grid div content
            const newHtml = currentHtml.substring(0, gridStart) +
                '<div class="features-grid">' + cardsHtml + '            </div>\r\n        </div>\r\n    </section>' +
                currentHtml.substring(actualEnd + useClosing.length);

            const b64 = btoa(unescape(encodeURIComponent(newHtml)));
            await ghUpload(token, 'faculty.html', b64);
        }

        // ══════════════════════════════════════════════════
        //  REBUILD COURSES PAGE HTML
        // ══════════════════════════════════════════════════
        async function rebuildCoursesPage(token, courses) {
            const url = `https://api.github.com/repos/${REPO}/contents/courses.html`;
            const headers = { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' };

            const res = await fetch(url, { headers });
            if (!res.ok) throw new Error('Could not fetch courses.html');
            const fileData = await res.json();
            const currentHtml = atob(fileData.content.replace(/\n/g, ''));

            const gridStart = currentHtml.indexOf('<div class="courses-grid" id="coursesGrid">');
            if (gridStart === -1) throw new Error('Could not find coursesGrid in courses.html');

            // Build course cards
            let cardsHtml = '\n';
            courses.forEach((c, i) => {
                const delayClass = i === 0 ? '' : (i === 1 ? ' delay-1' : ' delay-2');
                cardsHtml += `                <!-- Course ${i + 1} -->
                <div class="course-card scroll-reveal${delayClass}" data-category="${c.category}">
                    <div class="course-image">
                        <img src="${c.image}" alt="${c.title}">
                    </div>
                    <div class="course-content">
                        <h3>${c.title}</h3>
                        <p>${c.description}</p>
                    </div>
                    <div class="course-footer">
                        <span class="course-students"><i class="fa-solid fa-users"></i> Available</span>
                    </div>
                </div>\n`;
            });

            // Find the closing of courses-grid
            const closingTag = '</div>\r\n        </div>\r\n    </section>';
            const closingTagLF = '</div>\n        </div>\n    </section>';
            let actualEnd = currentHtml.indexOf(closingTag, gridStart + 30);
            let useClosing = closingTag;
            if (actualEnd === -1) {
                actualEnd = currentHtml.indexOf(closingTagLF, gridStart + 30);
                useClosing = closingTagLF;
            }

            // Find the correct section end (after coursesGrid)
            // We need the first </section> that closes the courses grid section
            const sectionEnd = currentHtml.indexOf('</section>', gridStart);
            const beforeSection = currentHtml.lastIndexOf('</div>', sectionEnd); // closing of container div
            const beforeContainer = currentHtml.lastIndexOf('</div>', beforeSection - 1); // closing of courses-grid

            const newHtml = currentHtml.substring(0, gridStart) +
                '<div class="courses-grid" id="coursesGrid">' + cardsHtml + '            </div>\r\n        </div>\r\n    </section>' +
                currentHtml.substring(sectionEnd + '</section>'.length);

            const b64 = btoa(unescape(encodeURIComponent(newHtml)));
            await ghUpload(token, 'courses.html', b64);
        }

        // ══════════════════════════════════════════════════
        //  REBUILD ABOUT PAGE HTML
        // ══════════════════════════════════════════════════
        async function rebuildAboutPage(token, about) {
            const url = `https://api.github.com/repos/${REPO}/contents/about.html`;
            const headers = { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' };
            const res = await fetch(url, { headers });
            if (!res.ok) throw new Error('Could not fetch about.html');
            const fileData = await res.json();
            let html = atob(fileData.content.replace(/\n/g, ''));

            // Replace about-content section
            const aboutStart = html.indexOf('<div class="about-content');
            const aboutEnd = html.indexOf('</div>', html.indexOf('</p>', html.indexOf('</p>', aboutStart + 1) + 1) + 1);
            if (aboutStart !== -1 && aboutEnd !== -1) {
                const newAboutContent = `<div class="about-content scroll-reveal">
                <h2>${about.heading}</h2>
                <p>${about.para1}</p>
                <p>${about.para2}</p>
            </div>`;
                html = html.substring(0, aboutStart) + newAboutContent + html.substring(aboutEnd + 6);
            }

            // Replace feature cards
            if (about.cards && about.cards.length >= 3) {
                const gridStart = html.indexOf('<div class="features-grid"');
                if (gridStart !== -1) {
                    const gridContentStart = html.indexOf('>', gridStart) + 1;
                    const gridEnd = html.indexOf('</div>\r\n        </div>\r\n    </section>', gridStart);
                    const gridEndLF = html.indexOf('</div>\n        </div>\n    </section>', gridStart);
                    const actualGridEnd = gridEnd !== -1 ? gridEnd : gridEndLF;
                    if (actualGridEnd !== -1) {
                        let cardsHtml = '\n';
                        about.cards.forEach((card, i) => {
                            const delay = i === 0 ? 'delay-1' : 'delay-2';
                            cardsHtml += `                <div class="feature-card scroll-reveal ${delay}">
                    <div class="icon-box"><i class="${card.icon}"></i></div>
                    <h3>${card.title}</h3>
                    <p>${card.desc}</p>
                </div>\n`;
                        });
                        html = html.substring(0, gridContentStart) + cardsHtml + '            ' + html.substring(actualGridEnd);
                    }
                }
            }

            // Replace image gallery ("Explore Our Campus")
            if (about.gallery && about.gallery.length > 0) {
                const galleryStart = html.indexOf('<div class="gallery-options');
                if (galleryStart !== -1) {
                    const galleryContentStart = html.indexOf('>', galleryStart) + 1;
                    // Find the closing </div> of gallery-options
                    let closeTag = html.indexOf('</div>', galleryStart);
                    // We need the outermost closing tag for gallery-options (after all cards)
                    // Count nested divs to find the right closing tag
                    let depth = 1;
                    let pos = galleryContentStart;
                    while (depth > 0 && pos < html.length) {
                        const nextOpen = html.indexOf('<div', pos);
                        const nextClose = html.indexOf('</div>', pos);
                        if (nextClose === -1) break;
                        if (nextOpen !== -1 && nextOpen < nextClose) {
                            depth++;
                            pos = nextOpen + 4;
                        } else {
                            depth--;
                            if (depth === 0) { closeTag = nextClose; break; }
                            pos = nextClose + 6;
                        }
                    }
                    let galleryHtml = '\n';
                    about.gallery.forEach((g, i) => {
                        const activeClass = i === 0 ? ' active' : '';
                        galleryHtml += `                <!-- Card ${i + 1} -->
                <div class="gallery-option${activeClass}"
                    style="--bg-url: url('${g.image}');">
                    <div class="shadow"></div>
                    <div class="label">
                        <div class="icon">
                            <i class="${g.icon}"></i>
                        </div>
                        <div class="info">
                            <div class="main">${g.title}</div>
                            <div class="sub">${g.sub}</div>
                        </div>
                    </div>
                </div>\n`;
                    });
                    galleryHtml += '            ';
                    html = html.substring(0, galleryContentStart) + galleryHtml + html.substring(closeTag);
                }
            }

            // Replace video gallery ("Campus Pulse")
            if (about.aboutVideos && about.aboutVideos.length > 0) {
                const videoStackStart = html.indexOf('<div class="video-stack" id="videoStack">');
                if (videoStackStart !== -1) {
                    const videoStackContentStart = html.indexOf('>', videoStackStart) + 1;
                    // Find closing </div> for video-stack
                    let depth = 1;
                    let pos = videoStackContentStart;
                    let closeTag = pos;
                    while (depth > 0 && pos < html.length) {
                        const nextOpen = html.indexOf('<div', pos);
                        const nextClose = html.indexOf('</div>', pos);
                        if (nextClose === -1) break;
                        if (nextOpen !== -1 && nextOpen < nextClose) {
                            depth++;
                            pos = nextOpen + 4;
                        } else {
                            depth--;
                            if (depth === 0) { closeTag = nextClose; break; }
                            pos = nextClose + 6;
                        }
                    }
                    let videoHtml = '\n';
                    about.aboutVideos.forEach((v, i) => {
                        const dataPos = i < 4 ? i : -1;
                        const activeClass = i === 0 ? ' active' : '';
                        videoHtml += `                    <!-- Card ${i + 1} -->
                    <div class="video-card${activeClass}" data-pos="${dataPos}">
                        <video loop muted autoplay playsinline>
                            <source src="${v.src}" type="video/mp4">
                        </video>
                        <div class="card-overlay">
                            <h3>${v.title}</h3>
                            <p>${v.desc}</p>
                        </div>
                    </div>\n`;
                    });
                    videoHtml += '                ';
                    html = html.substring(0, videoStackContentStart) + videoHtml + html.substring(closeTag);
                }
            }

            const b64 = btoa(unescape(encodeURIComponent(html)));
            await ghUpload(token, 'about.html', b64);
        }

        // ══════════════════════════════════════════════════
        //  REBUILD PLACEMENT PAGE HTML
        // ══════════════════════════════════════════════════
        async function rebuildPlacementPage(token, placements, stats) {
            const url = `https://api.github.com/repos/${REPO}/contents/placement.html`;
            const headers = { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' };
            const res = await fetch(url, { headers });
            if (!res.ok) throw new Error('Could not fetch placement.html');
            const fileData = await res.json();
            let html = atob(fileData.content.replace(/\n/g, ''));

            // Find the insertion point (between page-title section and footer)
            const footerStart = html.indexOf('<!-- Footer -->');
            const afterTitle = html.indexOf('</section>', html.indexOf('page-title-section'));
            if (afterTitle !== -1 && footerStart !== -1) {
                // Build placement content
                let placementHtml = '\r\n\r\n    <!-- Placement Content (Admin Generated) -->\r\n    <section class="section-padding">\r\n        <div class="container">\r\n';

                // Stats row
                if (stats.total || stats.recruiters || stats.highest) {
                    placementHtml += '            <div class="features-grid" style="margin-bottom: 50px;">\r\n';
                    if (stats.total) placementHtml += `                <div class="feature-card scroll-reveal"><div class="icon-box"><i class="fa-solid fa-users"></i></div><h3>${stats.total}</h3><p>Students Placed</p></div>\r\n`;
                    if (stats.recruiters) placementHtml += `                <div class="feature-card scroll-reveal delay-1"><div class="icon-box"><i class="fa-solid fa-building"></i></div><h3>${stats.recruiters}</h3><p>Top Recruiters</p></div>\r\n`;
                    if (stats.highest) placementHtml += `                <div class="feature-card scroll-reveal delay-2"><div class="icon-box"><i class="fa-solid fa-indian-rupee-sign"></i></div><h3>${stats.highest}</h3><p>Highest Package</p></div>\r\n`;
                    placementHtml += '            </div>\r\n';
                }

                // Placement table
                if (placements.length > 0) {
                    placementHtml += `            <div class="section-header scroll-reveal"><h2>Our Placed Students</h2><p>Proud achievements of our graduating students.</p></div>\r\n`;
                    placementHtml += '            <div style="overflow-x:auto;">\r\n            <table style="width:100%; border-collapse:collapse; background:white; border-radius:10px; overflow:hidden; box-shadow: var(--shadow);">\r\n';
                    placementHtml += '                <thead><tr style="background: var(--header-top-bg); color:white;"><th style="padding:14px 18px; text-align:left;">Student</th><th style="padding:14px 18px; text-align:left;">Company</th><th style="padding:14px 18px; text-align:left;">Role</th><th style="padding:14px 18px; text-align:left;">Package</th><th style="padding:14px 18px; text-align:left;">Year</th><th style="padding:14px 18px; text-align:left;">Dept</th></tr></thead>\r\n';
                    placementHtml += '                <tbody>\r\n';
                    placements.forEach((p, i) => {
                        const bg = i % 2 === 0 ? '#f9f9f9' : '#ffffff';
                        placementHtml += `                    <tr style="background:${bg};"><td style="padding:12px 18px;">${p.name}</td><td style="padding:12px 18px; font-weight:600;">${p.company}</td><td style="padding:12px 18px;">${p.role || '-'}</td><td style="padding:12px 18px;">${p.package || '-'}</td><td style="padding:12px 18px;">${p.year || '-'}</td><td style="padding:12px 18px;">${p.dept || '-'}</td></tr>\r\n`;
                    });
                    placementHtml += '                </tbody>\r\n            </table>\r\n            </div>\r\n';
                }

                placementHtml += '        </div>\r\n    </section>\r\n\r\n    ';

                // Remove any existing placement content section
                const existingContent = html.indexOf('<!-- Placement Content (Admin Generated) -->');
                let insertAfter, insertBefore;
                if (existingContent !== -1) {
                    // Replace existing
                    const existingEnd = html.indexOf('<!-- Footer -->', existingContent);
                    html = html.substring(0, existingContent) + placementHtml + html.substring(existingEnd);
                } else {
                    // Insert between title section end and footer
                    html = html.substring(0, afterTitle + '</section>'.length) + placementHtml + html.substring(footerStart);
                }
            }

            const b64 = btoa(unescape(encodeURIComponent(html)));
            await ghUpload(token, 'placement.html', b64);
        }

        // ══════════════════════════════════════════════════
        //  REBUILD CONTACT PAGE HTML
        // ══════════════════════════════════════════════════
        async function rebuildContactPage(token, contact) {
            const url = `https://api.github.com/repos/${REPO}/contents/contact.html`;
            const headers = { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' };
            const res = await fetch(url, { headers });
            if (!res.ok) throw new Error('Could not fetch contact.html');
            const fileData = await res.json();
            let html = atob(fileData.content.replace(/\n/g, ''));

            // Update address
            const addressStart = html.indexOf('<h4 style="margin-bottom: 5px; color: var(--header-top-bg);">Address</h4>');
            if (addressStart !== -1) {
                const pStart = html.indexOf('<p>', addressStart);
                const pEnd = html.indexOf('</p>', pStart);
                if (pStart !== -1 && pEnd !== -1) {
                    html = html.substring(0, pStart + 3) + contact.address + html.substring(pEnd);
                }
            }

            // Update phone
            const phoneStart = html.indexOf('<h4 style="margin-bottom: 5px; color: var(--header-top-bg);">Phone</h4>');
            if (phoneStart !== -1) {
                const pStart = html.indexOf('<p>', phoneStart);
                const pEnd = html.indexOf('</p>', pStart);
                if (pStart !== -1 && pEnd !== -1) {
                    html = html.substring(0, pStart + 3) + contact.phone + html.substring(pEnd);
                }
            }

            // Update email
            const emailStart = html.indexOf('<h4 style="margin-bottom: 5px; color: var(--header-top-bg);">Email</h4>');
            if (emailStart !== -1) {
                const pStart = html.indexOf('<p>', emailStart);
                const pEnd = html.indexOf('</p>', pStart);
                if (pStart !== -1 && pEnd !== -1) {
                    html = html.substring(0, pStart + 3) + contact.email.replace(/\n/g, '<br>') + html.substring(pEnd);
                }
            }

            // Update map URL
            if (contact.mapUrl) {
                const iframeStart = html.indexOf('<iframe');
                if (iframeStart !== -1) {
                    const srcStart = html.indexOf('src="', iframeStart) + 5;
                    const srcEnd = html.indexOf('"', srcStart);
                    if (srcStart > 4 && srcEnd !== -1) {
                        html = html.substring(0, srcStart) + contact.mapUrl + html.substring(srcEnd);
                    }
                }
            }

            const b64 = btoa(unescape(encodeURIComponent(html)));
            await ghUpload(token, 'contact.html', b64);
        }

        // ══════════════════════════════════════════════════
        //  REBUILD SITEMAP PAGE HTML
        // ══════════════════════════════════════════════════
        async function rebuildSitemapPage(token, sitemap) {
            const url = `https://api.github.com/repos/${REPO}/contents/sitemap.html`;
            const headers = { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' };
            const res = await fetch(url, { headers });
            if (!res.ok) throw new Error('Could not fetch sitemap.html');
            const fileData = await res.json();
            let html = atob(fileData.content.replace(/\n/g, ''));

            const visible = sitemap.filter(s => !s.hidden);
            const root = visible.find(s => s.isRoot) || visible[0];
            const branches = visible.filter(s => s !== root);

            // Rebuild the tree content
            const treeStart = html.indexOf('<div class="sitemap-tree">');
            const treeEnd = html.indexOf('<!-- XML Sitemap Link -->');
            if (treeStart !== -1 && treeEnd !== -1) {
                const treeContentStart = html.indexOf('>', treeStart) + 1;

                let treeHtml = '\n\n';

                // Root node
                if (root) {
                    treeHtml += `                <!-- Root: ${root.title} -->\n`;
                    treeHtml += `                <div class="tree-root scroll-reveal">\n`;
                    treeHtml += `                    <a href="${root.url}" class="sitemap-node">\n`;
                    treeHtml += `                        <div class="node-icon">\n`;
                    treeHtml += `                            <i class="${root.icon}"></i>\n`;
                    treeHtml += `                        </div>\n`;
                    treeHtml += `                        <div class="node-title">${root.title}</div>\n`;
                    treeHtml += `                        <div class="node-desc">${root.desc}</div>\n`;
                    treeHtml += `                        <div class="node-url">/${root.url}</div>\n`;
                    treeHtml += `                    </a>\n`;
                    treeHtml += `                </div>\n\n`;
                    treeHtml += `                <!-- Connector -->\n`;
                    treeHtml += `                <div class="tree-connector scroll-reveal"></div>\n\n`;
                }

                // Branch pages
                treeHtml += `                <!-- Branch Pages -->\n`;
                treeHtml += `                <div class="tree-branches">\n\n`;
                branches.forEach(s => {
                    const priorityClass = s.priority === 'high' ? 'priority-high' : s.priority === 'medium' ? 'priority-medium' : 'priority-low';
                    const priorityLabel = s.priority === 'high' ? 'High' : s.priority === 'medium' ? 'Medium' : 'Utility';
                    treeHtml += `                    <!-- ${s.title} -->\n`;
                    treeHtml += `                    <a href="${s.url}" class="sitemap-node scroll-reveal">\n`;
                    treeHtml += `                        <span class="node-priority ${priorityClass}">${priorityLabel}</span>\n`;
                    treeHtml += `                        <div class="node-icon">\n`;
                    treeHtml += `                            <i class="${s.icon}"></i>\n`;
                    treeHtml += `                        </div>\n`;
                    treeHtml += `                        <div class="node-title">${s.title}</div>\n`;
                    treeHtml += `                        <div class="node-desc">${s.desc}</div>\n`;
                    treeHtml += `                        <div class="node-url">/${s.url}</div>\n`;
                    treeHtml += `                    </a>\n\n`;
                });
                treeHtml += `                </div>\n`;
                treeHtml += `            </div>\n\n            `;

                html = html.substring(0, treeContentStart) + treeHtml + html.substring(treeEnd);
            }

            const b64 = btoa(unescape(encodeURIComponent(html)));
            await ghUpload(token, 'sitemap.html', b64);
        }

        // ══════════════════════════════════════════════════
        //  REBUILD SITEMAP XML
        // ══════════════════════════════════════════════════
        async function rebuildSitemapXml(token, sitemap) {
            const baseUrl = `https://rahulbisht1826.github.io/BMScollege`;
            const today = new Date().toISOString().split('T')[0];
            const visible = sitemap.filter(s => !s.hidden);

            let xml = `<?xml version="1.0" encoding="UTF-8"?>\n`;
            xml += `<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n`;

            visible.forEach(s => {
                const xmlPriority = s.priority === 'high' ? '0.9' : s.priority === 'medium' ? '0.7' : '0.5';
                const adjustedPriority = s.isRoot ? '1.0' : xmlPriority;
                xml += `\n    <!-- ${s.title} -->\n`;
                xml += `    <url>\n`;
                xml += `        <loc>${baseUrl}/${s.url}</loc>\n`;
                xml += `        <lastmod>${today}</lastmod>\n`;
                xml += `        <changefreq>${s.freq}</changefreq>\n`;
                xml += `        <priority>${adjustedPriority}</priority>\n`;
                xml += `    </url>\n`;
            });

            xml += `\n</urlset>\n`;

            const b64 = btoa(unescape(encodeURIComponent(xml)));
            await ghUpload(token, 'sitemap.xml', b64);
        }
    </script>
</body>

</html>